<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MCP 服务端开发指南 | 智库</title>
    <meta name="description" content="苟利国家生死以，岂因祸福避趋之">
    <meta name="generator" content="VitePress v2.0.0-alpha.16">
    <link rel="preload stylesheet" href="/assets/style.BiE4VZIv.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.YEGqcI-x.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.B0Esan1z.js">
    <link rel="modulepreload" href="/assets/chunks/framework.NCXUupj9.js">
    <link rel="modulepreload" href="/assets/ai_mcp_mcp-server.md.OXsBFHtw.lean.js">
    <link rel="icon" href="/favicon.ico">
    <meta property="og:type" content="website">
    <meta property="og:title" content="智库">
    <meta property="og:description" content="奶一口智库">
    <meta property="og:image" content="https://naico.wang/icons/icon-logo.png">
    <meta property="og:url" content="https://naico.wang">
    <meta name="referrer" content="no-referrer">
    <script>(function(r){"use strict";(function(a){var s=window,e=document,c=r,o="".concat(e.location.protocol==="https:"?"https://":"http://","sdk.51.la/js-sdk-pro.min.js"),t=e.createElement("script"),i=e.getElementsByTagName("script")[0];t.type="text/javascript",t.setAttribute("charset","UTF-8"),t.async=!0,t.src=o,t.id="LA_COLLECT",c.d=t;var n=function(){s.LA.ids.push(c)};s.LA?s.LA.ids&&n():(s.LA=r,s.LA.ids=[],n()),i.parentNode.insertBefore(t,i)})()})({id:"3ItqjsY11mrrfGg3",ck:"3ItqjsY11mrrfGg3",autoTrack:!0,hashMode:!0});</script>
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-d70b1323><!--[--><!--]--><!--[--><span tabindex="-1" data-v-fb4b3d3a></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-fb4b3d3a>Skip to content</a><!--]--><!----><header class="VPNav" data-v-d70b1323 data-v-eed9f036><div class="VPNavBar has-sidebar top" data-v-eed9f036 data-v-7f879658><div class="wrapper" data-v-7f879658><div class="container" data-v-7f879658><div class="title" data-v-7f879658><div class="VPNavBarTitle has-sidebar" data-v-7f879658 data-v-e2fe915e><a class="title" href="/" data-v-e2fe915e><!--[--><!--]--><!--[--><!--[--><!--[--><img class="VPImage dark logo" src="/images/logo-dark.svg" alt data-v-978bae9a><!--]--><!--[--><img class="VPImage light logo" src="/images/logo-light.svg" alt data-v-978bae9a><!--]--><!--]--><!--]--><span data-v-e2fe915e>智库</span><!--[--><!--]--></a></div></div><div class="content" data-v-7f879658><div class="content-body" data-v-7f879658><!--[--><!--]--><div class="VPNavBarSearch search" data-v-7f879658 data-v-0a1aad85><!--[--><button type="button" class="VPNavBarSearchButton" aria-label="Search" aria-keyshortcuts="/ control+k meta+k" data-v-0a1aad85 data-v-1c830a8e><span class="vpi-search" aria-hidden="true" data-v-1c830a8e></span><span class="text" data-v-1c830a8e>Search</span><span class="keys" aria-hidden="true" data-v-1c830a8e><kbd class="key-cmd" data-v-1c830a8e>⌘</kbd><kbd class="key-ctrl" data-v-1c830a8e>Ctrl</kbd><kbd data-v-1c830a8e>K</kbd></span></button><!----><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-7f879658 data-v-c90e0688><span id="main-nav-aria-label" class="visually-hidden" data-v-c90e0688> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/" tabindex="0" data-v-c90e0688 data-v-4e284e0d><!--[--><span data-v-4e284e0d>首页</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/ai.html" tabindex="0" data-v-c90e0688 data-v-4e284e0d><!--[--><span data-v-4e284e0d>AI 工程化</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-7f879658 data-v-10edae05><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-10edae05 data-v-771d01e9 data-v-146f5a1e><span class="check" data-v-146f5a1e><span class="icon" data-v-146f5a1e><!--[--><span class="vpi-sun sun" data-v-771d01e9></span><span class="vpi-moon moon" data-v-771d01e9></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-7f879658 data-v-4f923422 data-v-1578054f><!--[--><a class="VPSocialLink no-icon" href="https://github.com/naico-wang/naico-wang.github.io" aria-label="github" target="_blank" rel="me noopener" data-v-1578054f data-v-085c7257><span class="vpi-social-github"></span></a><a class="VPSocialLink no-icon" href="https://www.linkedin.com/in/naico-wang-49554891/" aria-label="linkedin" target="_blank" rel="me noopener" data-v-1578054f data-v-085c7257><span class="vpi-social-linkedin"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-7f879658 data-v-6e982ded data-v-b7fe3003><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-b7fe3003><span class="vpi-more-horizontal icon" data-v-b7fe3003></span></button><div class="menu" data-v-b7fe3003><div class="VPMenu" data-v-b7fe3003 data-v-570c90f8><!----><!--[--><!--[--><!----><div class="group" data-v-6e982ded><div class="item appearance" data-v-6e982ded><p class="label" data-v-6e982ded>Appearance</p><div class="appearance-action" data-v-6e982ded><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-6e982ded data-v-771d01e9 data-v-146f5a1e><span class="check" data-v-146f5a1e><span class="icon" data-v-146f5a1e><!--[--><span class="vpi-sun sun" data-v-771d01e9></span><span class="vpi-moon moon" data-v-771d01e9></span><!--]--></span></span></button></div></div></div><div class="group" data-v-6e982ded><div class="item social-links" data-v-6e982ded><div class="VPSocialLinks social-links-list" data-v-6e982ded data-v-1578054f><!--[--><a class="VPSocialLink no-icon" href="https://github.com/naico-wang/naico-wang.github.io" aria-label="github" target="_blank" rel="me noopener" data-v-1578054f data-v-085c7257><span class="vpi-social-github"></span></a><a class="VPSocialLink no-icon" href="https://www.linkedin.com/in/naico-wang-49554891/" aria-label="linkedin" target="_blank" rel="me noopener" data-v-1578054f data-v-085c7257><span class="vpi-social-linkedin"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-7f879658 data-v-61d15f3e><span class="container" data-v-61d15f3e><span class="top" data-v-61d15f3e></span><span class="middle" data-v-61d15f3e></span><span class="bottom" data-v-61d15f3e></span></span></button></div></div></div></div><div class="divider" data-v-7f879658><div class="divider-line" data-v-7f879658></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-d70b1323 data-v-4d794240><div class="container" data-v-4d794240><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-4d794240><span class="vpi-align-left menu-icon" data-v-4d794240></span><span class="menu-text" data-v-4d794240>菜单</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-4d794240 data-v-1b4724e4><button data-v-1b4724e4>回顶部</button><!----></div></div></div><aside class="VPSidebar" data-v-d70b1323 data-v-286bab1d><div class="curtain" data-v-286bab1d></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-286bab1d><span class="visually-hidden" id="sidebar-aria-label" data-v-286bab1d> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-46e4b36c><section class="VPSidebarItem level-0 collapsible has-active" data-v-46e4b36c data-v-b44a99a2><div class="item" role="button" tabindex="0" data-v-b44a99a2><div class="indicator" data-v-b44a99a2></div><h2 class="text" data-v-b44a99a2>AI 工程化规范</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b44a99a2><span class="vpi-chevron-right caret-icon" data-v-b44a99a2></span></div></div><div class="items" data-v-b44a99a2><!--[--><section class="VPSidebarItem level-1 collapsible has-active" data-v-b44a99a2 data-v-b44a99a2><div class="item" role="button" tabindex="0" data-v-b44a99a2><div class="indicator" data-v-b44a99a2></div><h3 class="text" data-v-b44a99a2>模型上下文协议</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b44a99a2><span class="vpi-chevron-right caret-icon" data-v-b44a99a2></span></div></div><div class="items" data-v-b44a99a2><!--[--><div class="VPSidebarItem level-2 is-link" data-v-b44a99a2 data-v-b44a99a2><div class="item" data-v-b44a99a2><div class="indicator" data-v-b44a99a2></div><a class="VPLink link link" href="/ai/mcp/mcp-introduction.html" data-v-b44a99a2><!--[--><p class="text" data-v-b44a99a2>MCP 总览</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b44a99a2 data-v-b44a99a2><div class="item" data-v-b44a99a2><div class="indicator" data-v-b44a99a2></div><a class="VPLink link link" href="/ai/mcp/mcp-server.html" data-v-b44a99a2><!--[--><p class="text" data-v-b44a99a2>MCP 服务端开发指南</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b44a99a2 data-v-b44a99a2><div class="item" data-v-b44a99a2><div class="indicator" data-v-b44a99a2></div><a class="VPLink link link" href="/ai/mcp/mcp-client.html" data-v-b44a99a2><!--[--><p class="text" data-v-b44a99a2>MCP 客户端开发指南</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b44a99a2 data-v-b44a99a2><div class="item" data-v-b44a99a2><div class="indicator" data-v-b44a99a2></div><a class="VPLink link link" href="/ai/mcp/mcp-security.html" data-v-b44a99a2><!--[--><p class="text" data-v-b44a99a2>MCP 认证与安全</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1 collapsible" data-v-b44a99a2 data-v-b44a99a2><div class="item" role="button" tabindex="0" data-v-b44a99a2><div class="indicator" data-v-b44a99a2></div><h3 class="text" data-v-b44a99a2>人工智能体</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b44a99a2><span class="vpi-chevron-right caret-icon" data-v-b44a99a2></span></div></div><div class="items" data-v-b44a99a2><!--[--><div class="VPSidebarItem level-2 is-link" data-v-b44a99a2 data-v-b44a99a2><div class="item" data-v-b44a99a2><div class="indicator" data-v-b44a99a2></div><a class="VPLink link link" href="/ai/agent/agent-overview.html" data-v-b44a99a2><!--[--><p class="text" data-v-b44a99a2>Agent 技术综述</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1 collapsible" data-v-b44a99a2 data-v-b44a99a2><div class="item" role="button" tabindex="0" data-v-b44a99a2><div class="indicator" data-v-b44a99a2></div><h3 class="text" data-v-b44a99a2>氛围编程</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b44a99a2><span class="vpi-chevron-right caret-icon" data-v-b44a99a2></span></div></div><div class="items" data-v-b44a99a2><!--[--><div class="VPSidebarItem level-2 is-link" data-v-b44a99a2 data-v-b44a99a2><div class="item" data-v-b44a99a2><div class="indicator" data-v-b44a99a2></div><a class="VPLink link link" href="/ai/vibe-coding/claude-code-guide.html" data-v-b44a99a2><!--[--><p class="text" data-v-b44a99a2>Claude Code 使用指南</p><!--]--></a><!----></div><!----></div><!--]--></div></section><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-d70b1323 data-v-6843e7e5><div class="VPDoc has-sidebar has-aside" data-v-6843e7e5 data-v-d89afd13><!--[--><!--]--><div class="container" data-v-d89afd13><div class="aside" data-v-d89afd13><div class="aside-curtain" data-v-d89afd13></div><div class="aside-container" data-v-d89afd13><div class="aside-content" data-v-d89afd13><div class="VPDocAside" data-v-d89afd13 data-v-d95d9c8d><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-d95d9c8d data-v-436840d7><div class="content" data-v-436840d7><div class="outline-marker" data-v-436840d7></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-436840d7>页面导航</div><ul class="VPDocOutlineItem root" data-v-436840d7 data-v-54152346><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-d95d9c8d></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-d89afd13><div class="content-container" data-v-d89afd13><!--[--><!--]--><main class="main" data-v-d89afd13><div style="position:relative;" class="vp-doc _ai_mcp_mcp-server external-link-icon-enabled" data-v-d89afd13><div><h1 id="mcp-服务端开发指南" tabindex="-1">MCP 服务端开发指南 <a class="header-anchor" href="#mcp-服务端开发指南" aria-label="Permalink to “MCP 服务端开发指南”">​</a></h1><h2 id="什么是-mcp-server" tabindex="-1">什么是 MCP Server <a class="header-anchor" href="#什么是-mcp-server" aria-label="Permalink to “什么是 MCP Server”">​</a></h2><h3 id="核心定义" tabindex="-1">核心定义 <a class="header-anchor" href="#核心定义" aria-label="Permalink to “核心定义”">​</a></h3><p><strong>MCP Server</strong> 是通过标准化 MCP 协议向 AI 应用暴露特定能力的程序。它可以是本地进程,也可以是远程服务。</p><p><strong>典型应用场景:</strong></p><!----><h2 id="server-核心能力" tabindex="-1">Server 核心能力 <a class="header-anchor" href="#server-核心能力" aria-label="Permalink to “Server 核心能力”">​</a></h2><p>MCP Server 通过三种基础构建模块向 AI 应用提供功能:</p><table tabindex="0"><thead><tr><th>能力</th><th>性质</th><th>控制方</th><th>典型用途</th></tr></thead><tbody><tr><td><strong>Tools(工具)</strong></td><td>主动调用的函数<br>可读写操作</td><td>AI 模型(需用户授权)</td><td>搜索航班、发送消息<br>创建日历事件、修改文件</td></tr><tr><td><strong>Resources(资源)</strong></td><td>被动的数据源<br>只读访问</td><td>应用程序</td><td>读取文档、访问数据库<br>获取 API 响应</td></tr><tr><td><strong>Prompts(提示模板)</strong></td><td>预构建的指令模板<br>引导交互</td><td>用户(显式触发)</td><td>规划旅行、总结会议<br>撰写邮件、代码审查</td></tr></tbody></table><h3 id="能力对比图示" tabindex="-1">能力对比图示 <a class="header-anchor" href="#能力对比图示" aria-label="Permalink to “能力对比图示”">​</a></h3><!----><h2 id="能力详解" tabindex="-1">能力详解 <a class="header-anchor" href="#能力详解" aria-label="Permalink to “能力详解”">​</a></h2><h3 id="_1-tools-工具" tabindex="-1">1. Tools (工具) <a class="header-anchor" href="#_1-tools-工具" aria-label="Permalink to “1. Tools (工具)”">​</a></h3><h4 id="核心特性" tabindex="-1">核心特性 <a class="header-anchor" href="#核心特性" aria-label="Permalink to “核心特性”">​</a></h4><p>Tools 使 AI 模型能够执行具体操作。每个工具:</p><ul><li>✓ 定义明确的输入/输出 schema (JSON Schema)</li><li>✓ 执行单一、明确的操作</li><li>✓ 支持用户授权机制</li><li>✓ 可被 LLM 自动发现和调用</li></ul><h4 id="协议方法" tabindex="-1">协议方法 <a class="header-anchor" href="#协议方法" aria-label="Permalink to “协议方法”">​</a></h4><table tabindex="0"><thead><tr><th>方法</th><th>说明</th><th>请求参数</th><th>返回值</th></tr></thead><tbody><tr><td><code>tools/list</code></td><td>发现可用工具</td><td>无</td><td>工具定义数组(含 schema)</td></tr><tr><td><code>tools/call</code></td><td>执行指定工具</td><td><code>name</code>, <code>arguments</code></td><td>工具执行结果</td></tr></tbody></table><h4 id="定义示例" tabindex="-1">定义示例 <a class="header-anchor" href="#定义示例" aria-label="Permalink to “定义示例”">​</a></h4><p><strong>航班搜索工具:</strong></p><div class="language-json line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">{</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;name&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;search_flights&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;description&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;搜索指定日期和城市间的可用航班&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;inputSchema&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">    &quot;type&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;object&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">    &quot;properties&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">      &quot;origin&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">        &quot;type&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;string&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">        &quot;description&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;出发城市(如 NYC, LAX)&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">      }</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">      &quot;destination&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">        &quot;type&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;string&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">        &quot;description&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;到达城市(如 Barcelona, Tokyo)&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">      }</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">      &quot;date&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">        &quot;type&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;string&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">        &quot;format&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;date&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">        &quot;description&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;出行日期(YYYY-MM-DD)&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">      }</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">      &quot;maxResults&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">        &quot;type&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;integer&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">        &quot;default&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 10</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">        &quot;description&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;返回结果的最大数量&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    }</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">    &quot;required&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> [</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&quot;origin&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;destination&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;date&quot;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">]</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h4 id="实战场景-旅行预订" tabindex="-1">实战场景: 旅行预订 <a class="header-anchor" href="#实战场景-旅行预订" aria-label="Permalink to “实战场景: 旅行预订”">​</a></h4><p><strong>多工具协作流程:</strong></p><!----><p><strong>工具组合示例:</strong></p><ol><li><p><strong><code>search_flights</code></strong>: 查询航班</p><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> callTool</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&#39;search_flights&#39;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  origin</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &#39;NYC&#39;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  destination</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &#39;Barcelona&#39;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  date</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &#39;2024-06-15&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">});</span></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// 返回: 47 个航班选项</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li><li><p><strong><code>create_calendar_event</code></strong>: 占用日历</p><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> callTool</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&#39;create_calendar_event&#39;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  title</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &#39;Barcelona Trip&#39;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  startDate</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &#39;2024-06-15&#39;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  endDate</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &#39;2024-06-22&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li><li><p><strong><code>send_email</code></strong>: 发送通知</p><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> callTool</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&#39;send_email&#39;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  to</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &#39;team@work.com&#39;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  subject</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &#39;Out of Office&#39;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  body</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &#39;我将于 6/15-6/22 外出...&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ol><h4 id="用户授权机制" tabindex="-1">用户授权机制 <a class="header-anchor" href="#用户授权机制" aria-label="Permalink to “用户授权机制”">​</a></h4><p><strong>Human-in-the-Loop 设计:</strong></p><!----><p><strong>客户端实现建议:</strong></p><ul><li><strong>敏感操作</strong>: 强制确认(删除、支付、发布)</li><li><strong>批量操作</strong>: 显示操作列表,一次性授权</li><li><strong>可信工具</strong>: 支持预授权,减少打断</li><li><strong>操作日志</strong>: 记录所有工具调用,便于审计</li></ul><h3 id="_2-resources-资源" tabindex="-1">2. Resources (资源) <a class="header-anchor" href="#_2-resources-资源" aria-label="Permalink to “2. Resources (资源)”">​</a></h3><h4 id="核心特性-1" tabindex="-1">核心特性 <a class="header-anchor" href="#核心特性-1" aria-label="Permalink to “核心特性”">​</a></h4><p>Resources 为 AI 应用提供结构化的只读数据访问:</p><ul><li>文件内容、数据库记录、API 响应</li><li>使用 URI 标识(如 <code>file:///path/to/doc.md</code>)</li><li>声明 MIME 类型(如 <code>text/plain</code>, <code>application/json</code>)</li><li>支持订阅机制,实时接收更新</li></ul><h4 id="协议方法-1" tabindex="-1">协议方法 <a class="header-anchor" href="#协议方法-1" aria-label="Permalink to “协议方法”">​</a></h4><table tabindex="0"><thead><tr><th>方法</th><th>说明</th><th>参数</th><th>返回值</th></tr></thead><tbody><tr><td><code>resources/list</code></td><td>列出直接资源</td><td>无</td><td>资源描述数组</td></tr><tr><td><code>resources/templates/list</code></td><td>发现资源模板</td><td>无</td><td>资源模板数组</td></tr><tr><td><code>resources/read</code></td><td>获取资源内容</td><td><code>uri</code></td><td>资源数据+元数据</td></tr><tr><td><code>resources/subscribe</code></td><td>订阅资源更新</td><td><code>uri</code></td><td>订阅确认</td></tr><tr><td><code>resources/unsubscribe</code></td><td>取消订阅</td><td><code>uri</code></td><td>取消确认</td></tr></tbody></table><h4 id="两种资源类型" tabindex="-1">两种资源类型 <a class="header-anchor" href="#两种资源类型" aria-label="Permalink to “两种资源类型”">​</a></h4><p><strong>1. 直接资源 (Direct Resources)</strong></p><p>固定 URI,指向特定数据:</p><div class="language-json line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">{</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;uri&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;calendar://events/2024&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;name&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;2024-calendar&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;description&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;2024 年全年日历事件&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;mimeType&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;application/json&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>访问示例:</strong></p><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> response</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> client</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.readResource</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&#39;calendar://events/2024&#39;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">);</span></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// 返回: { &quot;events&quot;: [...], &quot;busyDates&quot;: [...] }</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>2. 资源模板 (Resource Templates)</strong></p><p>动态 URI,支持参数化查询:</p><div class="language-json line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">{</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;uriTemplate&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;weather://forecast/{city}/{date}&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;name&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;weather-forecast&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;description&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;获取指定城市和日期的天气预报&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;mimeType&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;application/json&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>使用示例:</strong></p><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// 模板: weather://forecast/{city}/{date}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// 查询 1: 巴黎今日天气</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> client</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.readResource</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&#39;weather://forecast/Paris/2024-06-15&#39;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// 查询 2: 东京明日天气</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> client</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.readResource</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&#39;weather://forecast/Tokyo/2024-06-16&#39;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="uri-设计模式" tabindex="-1">URI 设计模式 <a class="header-anchor" href="#uri-设计模式" aria-label="Permalink to “URI 设计模式”">​</a></h4><p><strong>推荐的 URI 结构:</strong></p><table tabindex="0"><thead><tr><th>场景</th><th>URI 模式</th><th>示例</th></tr></thead><tbody><tr><td>本地文件</td><td><code>file:///</code></td><td><code>file:///home/user/docs/report.pdf</code></td></tr><tr><td>数据库</td><td><code>db://</code></td><td><code>db://localhost/products/users</code></td></tr><tr><td>API 资源</td><td><code>api://</code></td><td><code>api://github.com/repos/owner/repo/issues</code></td></tr><tr><td>自定义服务</td><td><code>custom://</code></td><td><code>travel://history/barcelona-2023</code></td></tr></tbody></table><h4 id="参数补全-parameter-completion" tabindex="-1">参数补全 (Parameter Completion) <a class="header-anchor" href="#参数补全-parameter-completion" aria-label="Permalink to “参数补全 (Parameter Completion)”">​</a></h4><p>资源模板支持智能参数提示:</p><!----><p><strong>实现示例:</strong></p><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">server</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.registerResourceTemplate</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">  &#39;weather://forecast/{city}/{date}&#39;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">  async</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> (params) </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">    // 参数补全逻辑</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> (</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">params</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">city</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">?.startsWith</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&#39;Par&#39;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">)) {</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> [</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&#39;Paris&#39;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &#39;Park City&#39;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &#39;Parma&#39;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">];</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    }</span></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">    // ...</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="实战场景-旅行规划上下文" tabindex="-1">实战场景: 旅行规划上下文 <a class="header-anchor" href="#实战场景-旅行规划上下文" aria-label="Permalink to “实战场景: 旅行规划上下文”">​</a></h4><p><strong>多资源组合:</strong></p><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// 1. 获取日历可用性</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> calendar</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> readResource</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&#39;calendar://events/2024-06&#39;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">);</span></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// 返回: { busyDates: [&#39;2024-06-10&#39;, &#39;2024-06-20&#39;], ... }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// 2. 读取旅行偏好</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> preferences</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> readResource</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&#39;travel://preferences/europe&#39;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">);</span></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// 返回: { airlines: [&#39;Lufthansa&#39;], hotels: [&#39;4-star+&#39;], ... }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// 3. 参考历史行程</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> history</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> readResource</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&#39;trips://history/barcelona-2023&#39;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">);</span></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// 返回: { visitedPlaces: [&#39;Sagrada Familia&#39;], ratings: {...} }</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>AI 应用的处理流程:</strong></p><!----><h4 id="资源订阅机制" tabindex="-1">资源订阅机制 <a class="header-anchor" href="#资源订阅机制" aria-label="Permalink to “资源订阅机制”">​</a></h4><p><strong>订阅流程:</strong></p><!----><p><strong>应用场景:</strong></p><ul><li>实时监控数据变化</li><li>文档协作编辑</li><li>聊天消息更新</li></ul><h3 id="_3-prompts-提示模板" tabindex="-1">3. Prompts (提示模板) <a class="header-anchor" href="#_3-prompts-提示模板" aria-label="Permalink to “3. Prompts (提示模板)”">​</a></h3><h4 id="核心特性-2" tabindex="-1">核心特性 <a class="header-anchor" href="#核心特性-2" aria-label="Permalink to “核心特性”">​</a></h4><p>Prompts 提供可复用的交互模板:</p><ul><li>结构化的参数定义</li><li>引导 AI 完成特定任务</li><li>可组合 Resources 和 Tools</li><li>由用户显式触发(非自动执行)</li></ul><h4 id="协议方法-2" tabindex="-1">协议方法 <a class="header-anchor" href="#协议方法-2" aria-label="Permalink to “协议方法”">​</a></h4><table tabindex="0"><thead><tr><th>方法</th><th>说明</th><th>参数</th><th>返回值</th></tr></thead><tbody><tr><td><code>prompts/list</code></td><td>发现可用模板</td><td>无</td><td>Prompt 描述数组</td></tr><tr><td><code>prompts/get</code></td><td>获取模板详情</td><td><code>name</code>, <code>arguments</code></td><td>完整 Prompt 定义</td></tr></tbody></table><h4 id="定义示例-1" tabindex="-1">定义示例 <a class="header-anchor" href="#定义示例-1" aria-label="Permalink to “定义示例”">​</a></h4><p><strong>旅行规划 Prompt:</strong></p><div class="language-json line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">{</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;name&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;plan-vacation&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;description&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;引导完成完整的旅行规划流程&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;arguments&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    {</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">      &quot;name&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;destination&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">      &quot;description&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;目的地城市&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">      &quot;required&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    }</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    {</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">      &quot;name&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;duration&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">      &quot;description&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;旅行天数&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">      &quot;required&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    }</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    {</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">      &quot;name&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;budget&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">      &quot;description&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;预算(美元)&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">      &quot;required&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> false</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    }</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    {</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">      &quot;name&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;interests&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">      &quot;description&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;兴趣爱好列表&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">      &quot;required&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> false</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  ]</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h4 id="使用流程" tabindex="-1">使用流程 <a class="header-anchor" href="#使用流程" aria-label="Permalink to “使用流程”">​</a></h4><!----><h4 id="对比-prompt-vs-自由对话" tabindex="-1">对比: Prompt vs 自由对话 <a class="header-anchor" href="#对比-prompt-vs-自由对话" aria-label="Permalink to “对比: Prompt vs 自由对话”">​</a></h4><table tabindex="0"><thead><tr><th>维度</th><th>自由对话</th><th>Prompt 模板</th></tr></thead><tbody><tr><td><strong>输入方式</strong></td><td>&quot;帮我规划去巴塞罗那的旅行&quot;</td><td>结构化表单填写</td></tr><tr><td><strong>参数完整性</strong></td><td>可能遗漏关键信息</td><td>强制填写必填项</td></tr><tr><td><strong>结果一致性</strong></td><td>每次可能不同</td><td>遵循固定流程</td></tr><tr><td><strong>可复用性</strong></td><td>需要重新描述</td><td>保存后随时调用</td></tr></tbody></table><h4 id="实战示例-代码审查-prompt" tabindex="-1">实战示例: 代码审查 Prompt <a class="header-anchor" href="#实战示例-代码审查-prompt" aria-label="Permalink to “实战示例: 代码审查 Prompt”">​</a></h4><div class="language-json line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">{</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;name&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;code-review&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;description&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;专业代码审查助手&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;arguments&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    {</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">      &quot;name&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;language&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">      &quot;description&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;编程语言&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">      &quot;required&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    }</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    {</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">      &quot;name&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;code&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">      &quot;description&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;待审查的代码&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">      &quot;required&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    }</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    {</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">      &quot;name&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;focus&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">      &quot;description&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;关注点&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">      &quot;required&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">      &quot;enum&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> [</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&quot;security&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;performance&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;readability&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;all&quot;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">]</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  ]</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p><strong>调用效果:</strong></p><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// 用户输入</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">{</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  language</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;TypeScript&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  code</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;const users = await db.query(&#39;SELECT * FROM users&#39;);&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  focus</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;security&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// AI 返回</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">{</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  issues</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    {</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">      severity</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;HIGH&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">      type</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;SQL Injection&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">      line</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 1</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">      suggestion</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;使用参数化查询或 ORM&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  ]</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  improvements</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> [</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">]</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  overallRating</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;Needs Work&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h4 id="用户交互模式" tabindex="-1">用户交互模式 <a class="header-anchor" href="#用户交互模式" aria-label="Permalink to “用户交互模式”">​</a></h4><p><strong>常见 UI 实现:</strong></p><ol><li><p><strong>Slash 命令</strong></p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span>用户输入: /plan-vacation</span></span>
<span class="line"><span>系统: 展示参数表单</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li><li><p><strong>命令面板</strong></p></li></ol><ul><li>快捷键: <code>Cmd/Ctrl + K</code></li><li>可搜索 Prompt 列表</li><li>显示描述和参数预览</li></ul><ol start="3"><li><p><strong>快捷按钮</strong></p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span>[总结会议] [撰写邮件] [规划旅行]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li><p><strong>右键菜单</strong></p></li></ol><ul><li>根据上下文推荐相关 Prompt</li><li>自动填充部分参数</li></ul><h2 id="多-server-协作" tabindex="-1">多 Server 协作 <a class="header-anchor" href="#多-server-协作" aria-label="Permalink to “多 Server 协作”">​</a></h2><h3 id="协作场景" tabindex="-1">协作场景 <a class="header-anchor" href="#协作场景" aria-label="Permalink to “协作场景”">​</a></h3><p>MCP 的真正威力体现在<strong>多个 Server 协同工作</strong>,组合各自的专业能力。</p><h4 id="示例-个性化旅行规划" tabindex="-1">示例: 个性化旅行规划 <a class="header-anchor" href="#示例-个性化旅行规划" aria-label="Permalink to “示例: 个性化旅行规划”">​</a></h4><p><strong>Server 架构:</strong></p><!----><h3 id="完整工作流" tabindex="-1">完整工作流 <a class="header-anchor" href="#完整工作流" aria-label="Permalink to “完整工作流”">​</a></h3><h4 id="_1-用户触发-prompt" tabindex="-1">1. 用户触发 Prompt <a class="header-anchor" href="#_1-用户触发-prompt" aria-label="Permalink to “1. 用户触发 Prompt”">​</a></h4><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// 用户填写表单</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">{</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  prompt</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;plan-vacation&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  arguments</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    destination</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;Barcelona&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    departure_date</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;2024-06-15&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    return_date</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;2024-06-22&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    budget</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 3000</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    travelers</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 2</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="_2-应用选择-resources" tabindex="-1">2. 应用选择 Resources <a class="header-anchor" href="#_2-应用选择-resources" aria-label="Permalink to “2. 应用选择 Resources”">​</a></h4><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// 用户勾选需要的上下文数据</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> resources</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> [</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">  &#39;calendar://my-calendar/June-2024&#39;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">      // 日历 Server</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">  &#39;travel://preferences/europe&#39;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">           // 旅行 Server</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">  &#39;travel://past-trips/Spain-2023&#39;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">        // 旅行 Server</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">  &#39;weather://climate/barcelona/summer&#39;</span><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">     // 天气 Server</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">];</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="_3-ai-读取-resources" tabindex="-1">3. AI 读取 Resources <a class="header-anchor" href="#_3-ai-读取-resources" aria-label="Permalink to “3. AI 读取 Resources”">​</a></h4><!----><h4 id="_4-ai-调用-tools" tabindex="-1">4. AI 调用 Tools <a class="header-anchor" href="#_4-ai-调用-tools" aria-label="Permalink to “4. AI 调用 Tools”">​</a></h4><!----><h4 id="_5-最终结果" tabindex="-1">5. 最终结果 <a class="header-anchor" href="#_5-最终结果" aria-label="Permalink to “5. 最终结果”">​</a></h4><p><strong>用户收到:</strong></p><ul><li>航班预订确认(早班机,直飞)</li><li>酒店预订确认(海景房,4星)</li><li>日历已更新(自动标记外出)</li><li>同事收到外出通知</li><li>完整行程单(包含天气提醒)</li></ul><p><strong>时间对比:</strong></p><ul><li>传统方式: 2-3 小时(搜索、对比、预订)</li><li>MCP 方式: 5-10 分钟(填表单、确认)</li></ul><h2 id="实战-开发天气-server" tabindex="-1">实战: 开发天气 Server <a class="header-anchor" href="#实战-开发天气-server" aria-label="Permalink to “实战: 开发天气 Server”">​</a></h2><h3 id="前置要求" tabindex="-1">前置要求 <a class="header-anchor" href="#前置要求" aria-label="Permalink to “前置要求”">​</a></h3><ul><li><strong>Node.js</strong>: v20+</li><li><strong>npm</strong>: 最新版本</li><li><strong>TypeScript</strong>: 基础语法</li><li><strong>API 知识</strong>: REST API 调用</li></ul><h3 id="项目目标" tabindex="-1">项目目标 <a class="header-anchor" href="#项目目标" aria-label="Permalink to “项目目标”">​</a></h3><p>构建一个提供两个工具的天气 Server:</p><ol><li><strong><code>get_alerts</code></strong>: 获取州的天气警报</li><li><strong><code>get_forecast</code></strong>: 获取位置的天气预报</li></ol><h3 id="快速开始" tabindex="-1">快速开始 <a class="header-anchor" href="#快速开始" aria-label="Permalink to “快速开始”">​</a></h3><h4 id="_1-创建项目" tabindex="-1">1. 创建项目 <a class="header-anchor" href="#_1-创建项目" aria-label="Permalink to “1. 创建项目”">​</a></h4><p><strong>macOS/Linux:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;"># 创建项目目录</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#2B5581;--shiki-dark:#9DB1C5;"> weather-server</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;"> &amp;&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> cd</span><span style="--shiki-light:#2B5581;--shiki-dark:#9DB1C5;"> weather-server</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;"># 初始化 npm</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#2B5581;--shiki-dark:#9DB1C5;"> init</span><span style="--shiki-light:#2B5581;--shiki-dark:#9DB1C5;"> -y</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;"># 安装依赖</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#2B5581;--shiki-dark:#9DB1C5;"> install</span><span style="--shiki-light:#2B5581;--shiki-dark:#9DB1C5;"> @modelcontextprotocol/sdk</span><span style="--shiki-light:#2B5581;--shiki-dark:#9DB1C5;"> zod@3</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#2B5581;--shiki-dark:#9DB1C5;"> install</span><span style="--shiki-light:#2B5581;--shiki-dark:#9DB1C5;"> -D</span><span style="--shiki-light:#2B5581;--shiki-dark:#9DB1C5;"> @types/node</span><span style="--shiki-light:#2B5581;--shiki-dark:#9DB1C5;"> typescript</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;"># 创建源文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#2B5581;--shiki-dark:#9DB1C5;"> src</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;"> &amp;&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> touch</span><span style="--shiki-light:#2B5581;--shiki-dark:#9DB1C5;"> src/index.ts</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><strong>Windows:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">md</span><span style="--shiki-light:#2B5581;--shiki-dark:#9DB1C5;"> weather-server</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cd</span><span style="--shiki-light:#2B5581;--shiki-dark:#9DB1C5;"> weather-server</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#2B5581;--shiki-dark:#9DB1C5;"> init</span><span style="--shiki-light:#2B5581;--shiki-dark:#9DB1C5;"> -y</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#2B5581;--shiki-dark:#9DB1C5;"> install</span><span style="--shiki-light:#2B5581;--shiki-dark:#9DB1C5;"> @modelcontextprotocol/sdk</span><span style="--shiki-light:#2B5581;--shiki-dark:#9DB1C5;"> zod@3</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#2B5581;--shiki-dark:#9DB1C5;"> install</span><span style="--shiki-light:#2B5581;--shiki-dark:#9DB1C5;"> -D</span><span style="--shiki-light:#2B5581;--shiki-dark:#9DB1C5;"> @types/node</span><span style="--shiki-light:#2B5581;--shiki-dark:#9DB1C5;"> typescript</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">md</span><span style="--shiki-light:#2B5581;--shiki-dark:#9DB1C5;"> src</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">new-item</span><span style="--shiki-light:#2B5581;--shiki-dark:#9DB1C5;"> src</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">\i</span><span style="--shiki-light:#2B5581;--shiki-dark:#9DB1C5;">ndex.ts</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="_2-配置-typescript" tabindex="-1">2. 配置 TypeScript <a class="header-anchor" href="#_2-配置-typescript" aria-label="Permalink to “2. 配置 TypeScript”">​</a></h4><p><strong>package.json:</strong></p><div class="language-json line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">{</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;type&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;module&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;bin&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">    &quot;weather&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;./build/index.js&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  }</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;scripts&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">    &quot;build&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;tsc &amp;&amp; node -e \&quot;require(&#39;fs&#39;).chmodSync(&#39;build/index.js&#39;, &#39;755&#39;)\&quot;&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">    &quot;dev&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;tsc &amp;&amp; node build/index.js&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  }</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;files&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> [</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&quot;build&quot;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">]</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>tsconfig.json:</strong></p><div class="language-json line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">{</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;compilerOptions&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">    &quot;target&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;ES2022&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">    &quot;module&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;Node16&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">    &quot;moduleResolution&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;Node16&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">    &quot;outDir&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;./build&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">    &quot;rootDir&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;./src&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">    &quot;strict&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">    &quot;esModuleInterop&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">    &quot;skipLibCheck&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  }</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;include&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> [</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&quot;src/**/*&quot;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">]</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;exclude&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> [</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&quot;node_modules&quot;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">]</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="核心代码实现" tabindex="-1">核心代码实现 <a class="header-anchor" href="#核心代码实现" aria-label="Permalink to “核心代码实现”">​</a></h3><h4 id="步骤-1-初始化-server" tabindex="-1">步骤 1: 初始化 Server <a class="header-anchor" href="#步骤-1-初始化-server" aria-label="Permalink to “步骤 1: 初始化 Server”">​</a></h4><p><strong>src/index.ts:</strong></p><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> { McpServer } </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;@modelcontextprotocol/sdk/server/mcp.js&quot;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">;</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> { StdioServerTransport } </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;@modelcontextprotocol/sdk/server/stdio.js&quot;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">;</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> { z } </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;zod&quot;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// 配置常量</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> NWS_API_BASE</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;https://api.weather.gov&quot;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">;</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> USER_AGENT</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;weather-app/1.0&quot;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// 创建 Server 实例</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> server</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> McpServer</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">({</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  name</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;weather&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  version</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;1.0.0&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="步骤-2-辅助函数" tabindex="-1">步骤 2: 辅助函数 <a class="header-anchor" href="#步骤-2-辅助函数" aria-label="Permalink to “步骤 2: 辅助函数”">​</a></h4><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// 类型定义</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AlertFeature</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  properties</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    event</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">;</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    areaDesc</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">;</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    severity</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">;</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    status</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">;</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    headline</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">;</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  };</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ForecastPeriod</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  name</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">;</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  temperature</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">;</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  temperatureUnit</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">;</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  windSpeed</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">;</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  windDirection</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">;</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  shortForecast</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">;</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AlertsResponse</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  features</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AlertFeature</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">[];</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PointsResponse</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  properties</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    forecast</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">;</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  };</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ForecastResponse</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  properties</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    periods</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ForecastPeriod</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">[];</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  };</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// API 请求封装</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> makeNWSRequest</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">T</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">&gt;(url</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">)</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Promise</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">T</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">&gt; {</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> headers</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">    &quot;User-Agent&quot;</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> USER_AGENT</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    Accept</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;application/geo+json&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">  try</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> response</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetch</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(url</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> { headers });</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    </span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> (</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">response</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">.ok) {</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">      throw</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Error</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">`HTTP </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">${</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">response</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">.status</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">}</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">: </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">${</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">response</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">.statusText</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">}</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">`</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">);</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    </span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> (</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> response</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.json</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">()) </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> T</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">;</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  } </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> (error) {</span></span>
<span class="line"><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">    console</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.error</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&quot;NWS API 请求失败:&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> error);</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">;</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// 格式化警报信息</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> formatAlert</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(feature</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AlertFeature</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">)</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> props</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> feature</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">.properties;</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> [</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">    `事件: </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">${</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">props</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">.event </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;未知&quot;</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">}</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">`</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">    `区域: </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">${</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">props</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">.areaDesc </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;未知&quot;</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">}</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">`</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">    `严重程度: </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">${</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">props</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">.severity </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;未知&quot;</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">}</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">`</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">    `状态: </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">${</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">props</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">.status </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;未知&quot;</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">}</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">`</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">    `标题: </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">${</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">props</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">.headline </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;无标题&quot;</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">}</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">`</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">    &quot;─&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.repeat</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#1976D2;--shiki-dark:#F8F8F8;">50</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">)</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  ]</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.join</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&quot;\n&quot;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">);</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// 格式化预报信息</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> formatForecast</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(period</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ForecastPeriod</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">)</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> [</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">    `</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">${</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">period</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">.name </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;未知&quot;</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">}</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">:`</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">    `温度: </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">${</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">period</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">.temperature </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;?&quot;</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">}</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">°</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">${</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">period</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">.temperatureUnit </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;F&quot;</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">}</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">`</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">    `风速: </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">${</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">period</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">.windSpeed </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;未知&quot;</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">}</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> ${</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">period</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">.windDirection </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;&quot;</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">}</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">`</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">    `概况: </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">${</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">period</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">.shortForecast </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;无可用预报&quot;</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">}</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">`</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">    &quot;─&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.repeat</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#1976D2;--shiki-dark:#F8F8F8;">50</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">)</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  ]</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.join</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&quot;\n&quot;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">);</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br></div></div><h4 id="步骤-3-注册工具" tabindex="-1">步骤 3: 注册工具 <a class="header-anchor" href="#步骤-3-注册工具" aria-label="Permalink to “步骤 3: 注册工具”">​</a></h4><p><strong>工具 1: 获取天气警报</strong></p><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">server</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.registerTool</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">  &quot;get_alerts&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  {</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    description</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;获取美国指定州的活动天气警报&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    inputSchema</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">      state</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> z</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        .string</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">()</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        .length</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#1976D2;--shiki-dark:#F8F8F8;">2</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        .toUpperCase</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">()</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        .describe</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&quot;两字母州代码(如 CA, NY, TX)&quot;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">)</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    }</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  }</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">  async</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> ({ state }) </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> stateCode</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> state</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.toUpperCase</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">();</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> url</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> `</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">${</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">NWS_API_BASE</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">}</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">/alerts?area=</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">${</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">stateCode</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">}</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">`</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">;</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    </span></span>
<span class="line"><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">    console</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.error</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">`🔍 查询 </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">${</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">stateCode</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">}</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> 的天气警报...`</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">);</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    </span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> data</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> makeNWSRequest</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AlertsResponse</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">&gt;(url);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> (</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">data) {</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">        content</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> [{</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">          type</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;text&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">          text</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> `获取 </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">${</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">stateCode</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">}</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> 警报数据失败,请稍后重试`</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">        }]</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">      };</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> features</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> data</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">.features </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> [];</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    </span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> (</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">features</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">.</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> ===</span><span style="--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 0</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">) {</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">        content</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> [{</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">          type</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;text&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">          text</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> `</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">${</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">stateCode</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">}</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> 当前没有活动天气警报`</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">        }]</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">      };</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> formattedAlerts</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> features</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.map</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(formatAlert)</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.join</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&quot;\n&quot;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">);</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    </span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">      content</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> [{</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">        type</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;text&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">        text</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> `</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">${</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">stateCode</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">}</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> 活动警报 (共 </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">${</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">features</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">.</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">}</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> 条):\n\n</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">${</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">formattedAlerts</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">}</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">`</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">      }]</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    };</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br></div></div><p><strong>工具 2: 获取天气预报</strong></p><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">server</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.registerTool</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">  &quot;get_forecast&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  {</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    description</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;获取美国境内指定坐标的 7 天天气预报&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    inputSchema</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">      latitude</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> z</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        .number</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">()</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        .min</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#1976D2;--shiki-dark:#F8F8F8;">90</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        .max</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#1976D2;--shiki-dark:#F8F8F8;">90</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        .describe</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&quot;纬度(-90 到 90)&quot;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">)</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">      longitude</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> z</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        .number</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">()</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        .min</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#1976D2;--shiki-dark:#F8F8F8;">180</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        .max</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#1976D2;--shiki-dark:#F8F8F8;">180</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        .describe</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&quot;经度(-180 到 180)&quot;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">)</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    }</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  }</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">  async</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> ({ latitude</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> longitude }) </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">    console</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.error</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">`查询坐标 </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">${</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">latitude</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">}</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">, </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">${</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">longitude</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">}</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> 的天气预报...`</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">);</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    </span></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">    // 步骤 1: 获取网格点数据</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> pointsUrl</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> `</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">${</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">NWS_API_BASE</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">}</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">/points/</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">${</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">latitude</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.toFixed</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#1976D2;--shiki-dark:#F8F8F8;">4</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">)</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">}</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">,</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">${</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">longitude</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.toFixed</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#1976D2;--shiki-dark:#F8F8F8;">4</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">)</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">}</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">`</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">;</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> pointsData</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> makeNWSRequest</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">PointsResponse</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">&gt;(pointsUrl);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> (</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">pointsData) {</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">        content</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> [{</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">          type</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;text&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">          text</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> `获取坐标 </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">${</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">latitude</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">}</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">, </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">${</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">longitude</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">}</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> 的网格数据失败。\n提示: NWS API 仅支持美国境内位置。`</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">        }]</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">      };</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> forecastUrl</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> pointsData</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">.</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">properties</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">?.forecast;</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> (</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">forecastUrl) {</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">        content</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> [{</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">          type</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;text&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">          text</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;无法从网格数据中提取预报 URL&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">        }]</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">      };</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">    // 步骤 2: 获取预报数据</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> forecastData</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> makeNWSRequest</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ForecastResponse</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">&gt;(forecastUrl);</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    </span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> (</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">forecastData) {</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">        content</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> [{</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">          type</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;text&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">          text</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;获取预报数据失败&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">        }]</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">      };</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> periods</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> forecastData</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">.</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">properties</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">?.periods </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> [];</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    </span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> (</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">periods</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">.</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> ===</span><span style="--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 0</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">) {</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">        content</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> [{</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">          type</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;text&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">          text</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;无可用的预报时段&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">        }]</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">      };</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> formattedForecast</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> periods</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.map</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(formatForecast)</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.join</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&quot;\n&quot;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">);</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    </span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">      content</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> [{</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">        type</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;text&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">        text</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> `坐标 </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">${</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">latitude</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">}</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">, </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">${</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">longitude</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">}</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> 的天气预报:\n\n</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">${</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">formattedForecast</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">}</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">`</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">      }]</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    };</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br></div></div><h4 id="步骤-4-启动-server" tabindex="-1">步骤 4: 启动 Server <a class="header-anchor" href="#步骤-4-启动-server" aria-label="Permalink to “步骤 4: 启动 Server”">​</a></h4><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">() {</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> transport</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> StdioServerTransport</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">();</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">  await</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> server</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.connect</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(transport);</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  </span></span>
<span class="line"><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">  console</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.error</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&quot;Weather MCP Server 已启动&quot;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">);</span></span>
<span class="line"><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">  console</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.error</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&quot;传输方式: STDIO&quot;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">);</span></span>
<span class="line"><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">  console</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.error</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&quot;可用工具: get_alerts, get_forecast&quot;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">);</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">main</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">()</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.catch</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">((error) </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">  console</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.error</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&quot;致命错误:&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> error);</span></span>
<span class="line"><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">  process</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.exit</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#1976D2;--shiki-dark:#F8F8F8;">1</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">);</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="关键注意事项" tabindex="-1">关键注意事项 <a class="header-anchor" href="#关键注意事项" aria-label="Permalink to “关键注意事项”">​</a></h3><h4 id="日志记录规范" tabindex="-1">日志记录规范 <a class="header-anchor" href="#日志记录规范" aria-label="Permalink to “日志记录规范”">​</a></h4><div class="danger custom-block"><p class="custom-block-title">严重警告</p><p><strong>STDIO 传输的 Server 绝对不能写入 stdout!</strong></p></div><p><strong>错误示例:</strong></p><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">console</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.log</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&quot;Server started&quot;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">);        </span><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// 破坏 JSON-RPC</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">print</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&quot;Processing request&quot;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">);          </span><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// Python</span></span>
<span class="line"><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">fmt</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.Println</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&quot;Request received&quot;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">);      </span><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// Go</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>正确示例:</strong></p><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">console</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.error</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&quot;Server started&quot;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">);      </span><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// 写入 stderr</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> winston </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &#39;winston&#39;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">;        </span><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// 使用日志库</span></span>
<span class="line"><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">fs</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.appendFileSync</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&#39;server.log&#39;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> msg); </span><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// 写入文件</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>原因说明:</strong></p><p>MCP 通过 stdin/stdout 传输 JSON-RPC 消息。任何额外的 stdout 输出都会破坏消息格式,导致解析失败。</p><p><strong>HTTP 传输例外:</strong></p><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// HTTP Server 可以使用 console.log</span></span>
<span class="line"><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">app</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.listen</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#1976D2;--shiki-dark:#F8F8F8;">3000</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> () </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">  console</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.log</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&quot;Server listening on port 3000&quot;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">); </span><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// HTTP 可以</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="推荐日志方案" tabindex="-1">推荐日志方案 <a class="header-anchor" href="#推荐日志方案" aria-label="Permalink to “推荐日志方案”">​</a></h4><p><strong>TypeScript/JavaScript:</strong></p><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> winston </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &#39;winston&#39;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> logger</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> winston</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.createLogger</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">({</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  level</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &#39;info&#39;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  transports</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> [</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">    new</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> winston</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">transports</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.File</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">({ filename</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &#39;error.log&#39;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> level</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &#39;error&#39;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> })</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">    new</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> winston</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">transports</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.File</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">({ filename</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &#39;combined.log&#39;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> })</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">    new</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> winston</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">transports</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.Console</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">({ </span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">      stderrLevels</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> [</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&#39;error&#39;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &#39;warn&#39;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &#39;info&#39;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &#39;debug&#39;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">] </span><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// 强制使用 stderr</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    })</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  ]</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">logger</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.info</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&quot;Server started&quot;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong>Python:</strong></p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> logging</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">logging</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">basicConfig</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">(</span></span>
<span class="line"><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">    level</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">logging.INFO,</span></span>
<span class="line"><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">    format</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&#39;</span><span style="--shiki-light:#1976D2;--shiki-dark:#F8F8F8;">%(asctime)s</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> - </span><span style="--shiki-light:#1976D2;--shiki-dark:#F8F8F8;">%(levelname)s</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> - </span><span style="--shiki-light:#1976D2;--shiki-dark:#F8F8F8;">%(message)s</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&#39;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">    handlers</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">[</span></span>
<span class="line"><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">        logging.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FileHandler</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&#39;server.log&#39;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">),</span></span>
<span class="line"><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">        logging.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">StreamHandler</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">(sys.stderr)  </span><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;"># 使用 stderr</span></span>
<span class="line"><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">    ]</span></span>
<span class="line"><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">logging</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">info</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&quot;Server started&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="测试-server" tabindex="-1">测试 Server <a class="header-anchor" href="#测试-server" aria-label="Permalink to “测试 Server”">​</a></h3><h4 id="使用-claude-desktop" tabindex="-1">使用 Claude Desktop <a class="header-anchor" href="#使用-claude-desktop" aria-label="Permalink to “使用 Claude Desktop”">​</a></h4><p><strong>1. 安装 Claude Desktop</strong></p><p>下载地址: <a href="https://claude.ai/download" target="_blank" rel="noreferrer">https://claude.ai/download</a></p><p><strong>2. 配置 Server</strong></p><p>编辑配置文件:</p><ul><li><strong>macOS</strong>: <code>~/Library/Application Support/Claude/claude_desktop_config.json</code></li><li><strong>Windows</strong>: <code>%AppData%\Claude\claude_desktop_config.json</code></li></ul><p><strong>配置示例 (macOS/Linux):</strong></p><div class="language-json line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">{</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;mcpServers&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">    &quot;weather&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">      &quot;command&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;node&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">      &quot;args&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> [</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">        &quot;/Users/yourname/projects/weather-server/build/index.js&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">      ]</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>配置示例 (Windows):</strong></p><div class="language-json line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">{</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;mcpServers&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">    &quot;weather&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">      &quot;command&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;node&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">      &quot;args&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> [</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">        &quot;C:\\Users\\yourname\\projects\\weather-server\\build\\index.js&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">      ]</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="warning custom-block"><p class="custom-block-title">重要</p><p>必须使用<strong>绝对路径</strong>,不能使用相对路径或 <code>~</code> 符号。</p></div><p><strong>3. 重启 Claude Desktop</strong></p><div class="tip custom-block"><p class="custom-block-title">完全退出</p><ul><li><strong>macOS</strong>: <code>Cmd + Q</code> 或菜单栏 &quot;退出 Claude&quot;</li><li><strong>Windows</strong>: 系统托盘右键 → &quot;退出&quot;</li></ul><p>仅关闭窗口不会重新加载配置!</p></div><p><strong>4. 验证连接</strong></p><p>在 Claude 中查找工具图标(🔧 或 &quot;连接器&quot; 菜单),应该看到:</p><ul><li>weather server</li><li>get_alerts</li><li>get_forecast</li></ul><p><strong>5. 测试查询</strong></p><p>尝试以下对话:</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span>User: Sacramento 的天气怎么样?</span></span>
<span class="line"><span></span></span>
<span class="line"><span>AI: [调用 get_forecast 工具]</span></span>
<span class="line"><span>    Sacramento (38.5816, -121.4944) 的天气预报:</span></span>
<span class="line"><span>    今晚: 晴朗,温度 18°F...</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span>User: 德克萨斯州有哪些天气警报?</span></span>
<span class="line"><span></span></span>
<span class="line"><span>AI: [调用 get_alerts 工具]</span></span>
<span class="line"><span>    TX 当前有 3 条活动警报:</span></span>
<span class="line"><span>    1. 高温警告 - 达拉斯地区...</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="工作原理解析" tabindex="-1">工作原理解析 <a class="header-anchor" href="#工作原理解析" aria-label="Permalink to “工作原理解析”">​</a></h3><p><strong>完整交互流程:</strong></p><!----><p><strong>关键步骤说明:</strong></p><ol><li><strong>工具发现</strong>: Client 获取 Server 的工具清单</li><li><strong>智能决策</strong>: Claude 分析查询,选择合适的工具</li><li><strong>用户授权</strong>: 展示工具调用详情,等待确认</li><li><strong>工具执行</strong>: Server 调用外部 API 获取数据</li><li><strong>结果返回</strong>: Server 格式化数据返回给 Client</li><li><strong>自然回复</strong>: Claude 将结果转化为自然语言</li></ol><h2 id="故障排除" tabindex="-1">故障排除 <a class="header-anchor" href="#故障排除" aria-label="Permalink to “故障排除”">​</a></h2><h3 id="常见问题" tabindex="-1">常见问题 <a class="header-anchor" href="#常见问题" aria-label="Permalink to “常见问题”">​</a></h3><h4 id="_1-server-未在-claude-中显示" tabindex="-1">1. Server 未在 Claude 中显示 <a class="header-anchor" href="#_1-server-未在-claude-中显示" aria-label="Permalink to “1. Server 未在 Claude 中显示”">​</a></h4><p><strong>排查步骤:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;"># 1. 检查配置文件语法</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#2B5581;--shiki-dark:#9DB1C5;"> ~/Library/Application</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">\ </span><span style="--shiki-light:#2B5581;--shiki-dark:#9DB1C5;">Support/Claude/claude_desktop_config.json</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> jq</span><span style="--shiki-light:#2B5581;--shiki-dark:#9DB1C5;"> .</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;"># 2. 验证路径是否存在</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ls</span><span style="--shiki-light:#2B5581;--shiki-dark:#9DB1C5;"> -l</span><span style="--shiki-light:#2B5581;--shiki-dark:#9DB1C5;"> /path/to/weather-server/build/index.js</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;"># 3. 测试 Server 是否可运行</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">node</span><span style="--shiki-light:#2B5581;--shiki-dark:#9DB1C5;"> /path/to/weather-server/build/index.js</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;"># 4. 查看 Claude 日志</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tail</span><span style="--shiki-light:#2B5581;--shiki-dark:#9DB1C5;"> -f</span><span style="--shiki-light:#2B5581;--shiki-dark:#9DB1C5;"> ~/Library/Logs/Claude/mcp*.log</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>常见错误:</strong></p><table tabindex="0"><thead><tr><th>错误</th><th>原因</th><th>解决方法</th></tr></thead><tbody><tr><td>JSON 解析失败</td><td>配置文件格式错误</td><td>使用 <code>jq</code> 或 JSON 校验工具检查</td></tr><tr><td>文件不存在</td><td>路径错误</td><td>使用绝对路径,检查文件权限</td></tr><tr><td>Server 崩溃</td><td>代码错误</td><td>查看 <code>mcp-server-weather.log</code></td></tr></tbody></table><h4 id="_2-工具调用失败" tabindex="-1">2. 工具调用失败 <a class="header-anchor" href="#_2-工具调用失败" aria-label="Permalink to “2. 工具调用失败”">​</a></h4><p><strong>调试日志:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;"># macOS</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tail</span><span style="--shiki-light:#2B5581;--shiki-dark:#9DB1C5;"> -n</span><span style="--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 50</span><span style="--shiki-light:#2B5581;--shiki-dark:#9DB1C5;"> ~/Library/Logs/Claude/mcp-server-weather.log</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;"># Windows</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">type</span><span style="--shiki-light:#2B5581;--shiki-dark:#9DB1C5;"> %AppData%</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">\C</span><span style="--shiki-light:#2B5581;--shiki-dark:#9DB1C5;">laude</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">\L</span><span style="--shiki-light:#2B5581;--shiki-dark:#9DB1C5;">ogs</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">\m</span><span style="--shiki-light:#2B5581;--shiki-dark:#9DB1C5;">cp-server-weather.log</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>常见错误模式:</strong></p><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// 错误: 未捕获异常</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getTool</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">() {</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> data</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> riskyOperation</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(); </span><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// 可能抛出错误</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> data;</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// 正确: 完善错误处理</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getTool</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">() {</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">  try</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> data</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> riskyOperation</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">();</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">      content</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> [{ type</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;text&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> text</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> formatData</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(data) }]</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    };</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  } </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> (error) {</span></span>
<span class="line"><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">    console</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.error</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&quot;工具执行失败:&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> error);</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">      content</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> [{ </span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">        type</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;text&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> </span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">        text</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> `执行失败: </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">${</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">error</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">.message</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">}</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">`</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> </span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">      }]</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">      isError</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    };</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h4 id="_3-性能问题" tabindex="-1">3. 性能问题 <a class="header-anchor" href="#_3-性能问题" aria-label="Permalink to “3. 性能问题”">​</a></h4><p><strong>优化建议:</strong></p><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// 慢: 每次都重新获取</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getForecast</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(lat</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> lon) {</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> points</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetch</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">`/points/</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">${</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">lat</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">}</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">,</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">${</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">lon</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">}</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">`</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">);</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> forecast</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetch</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">points</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">.forecastUrl);</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> forecast;</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// 快: 添加缓存</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> cache</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Map</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getForecast</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(lat</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> lon) {</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> key</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> `</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">${</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">lat</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">}</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">,</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">${</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">lon</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">}</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">`</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">;</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  </span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> (</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">cache</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.has</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(key)) {</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> cached</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> cache</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.get</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(key);</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> (</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">Date</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.now</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">() </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> cached</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">.timestamp </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 3600000</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">) { </span><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// 1 小时</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> cached</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">.data;</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  </span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> data</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetchForecast</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(lat</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> lon);</span></span>
<span class="line"><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">  cache</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.set</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(key</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> { data</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> timestamp</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> Date</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.now</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">() });</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> data;</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h2 id="最佳实践" tabindex="-1">最佳实践 <a class="header-anchor" href="#最佳实践" aria-label="Permalink to “最佳实践”">​</a></h2><h3 id="server-设计原则" tabindex="-1">Server 设计原则 <a class="header-anchor" href="#server-设计原则" aria-label="Permalink to “Server 设计原则”">​</a></h3><h4 id="_1-单一职责" tabindex="-1">1. 单一职责 <a class="header-anchor" href="#_1-单一职责" aria-label="Permalink to “1. 单一职责”">​</a></h4><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// 好: 专注天气数据</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> WeatherServer</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  getAlerts</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">() {}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  getForecast</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">() {}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  getClimate</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">() {}</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// 差: 职责混杂</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SuperServer</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  getWeather</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">() {}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  sendEmail</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">() {}    </span><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// 应该独立为 Email Server</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  queryDatabase</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">() {} </span><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// 应该独立为 Database Server</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="_2-幂等性" tabindex="-1">2. 幂等性 <a class="header-anchor" href="#_2-幂等性" aria-label="Permalink to “2. 幂等性”">​</a></h4><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// 幂等操作 - 多次调用结果相同</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> readFile</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(path</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">) {</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> fs</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.readFileSync</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(path</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &#39;utf-8&#39;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">);</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// 非幂等操作 - 需要特殊处理</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> deleteFile</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(path</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">) {</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> (</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">fs</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.existsSync</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(path)) {</span></span>
<span class="line"><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">    fs</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.unlinkSync</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(path);</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> { deleted</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> };</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  }</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> { deleted</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> reason</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;File not found&quot;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> };</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="_3-清晰的错误信息" tabindex="-1">3. 清晰的错误信息 <a class="header-anchor" href="#_3-清晰的错误信息" aria-label="Permalink to “3. 清晰的错误信息”">​</a></h4><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// 差: 错误信息模糊</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">throw</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Error</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&quot;Failed&quot;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// 好: 提供上下文和建议</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">throw</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Error</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">  `无法读取文件 </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">${</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">path</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">}</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">:\n`</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> +</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">  `原因: 文件不存在\n`</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> +</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">  `建议: 请检查路径是否正确,或使用 list_files 工具查看可用文件`</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="_4-输入校验" tabindex="-1">4. 输入校验 <a class="header-anchor" href="#_4-输入校验" aria-label="Permalink to “4. 输入校验”">​</a></h4><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">server</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.registerTool</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">  &quot;search&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  {</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    description</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;搜索功能&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    inputSchema</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">      query</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> z</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        .string</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">()</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        .min</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#1976D2;--shiki-dark:#F8F8F8;">1</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;查询字符串不能为空&quot;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        .max</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#1976D2;--shiki-dark:#F8F8F8;">100</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;查询字符串不能超过 100 字符&quot;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">)</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">      limit</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> z</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        .number</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">()</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        .int</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&quot;必须是整数&quot;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        .min</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#1976D2;--shiki-dark:#F8F8F8;">1</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        .max</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#1976D2;--shiki-dark:#F8F8F8;">100</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        .default</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#1976D2;--shiki-dark:#F8F8F8;">10</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">)</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    }</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  }</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">  async</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> ({ query</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> limit }) </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">    // Zod 已经完成校验,这里可以安全使用</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> results</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> performSearch</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(query</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> limit);</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> { content</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> [{ type</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;text&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> text</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> formatResults</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(results) }] };</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="安全建议" tabindex="-1">安全建议 <a class="header-anchor" href="#安全建议" aria-label="Permalink to “安全建议”">​</a></h3><h4 id="_1-输入清理" tabindex="-1">1. 输入清理 <a class="header-anchor" href="#_1-输入清理" aria-label="Permalink to “1. 输入清理”">​</a></h4><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// 危险: SQL 注入风险</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> query</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> `SELECT * FROM users WHERE name = &#39;</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">${</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">userName</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">}</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&#39;`</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// 安全: 参数化查询</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> query</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> db</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.prepare</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&#39;SELECT * FROM users WHERE name = ?&#39;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">);</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> results</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> query</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.all</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(userName);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="_2-路径遍历防护" tabindex="-1">2. 路径遍历防护 <a class="header-anchor" href="#_2-路径遍历防护" aria-label="Permalink to “2. 路径遍历防护”">​</a></h4><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// 危险: 可能访问任意文件</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> readFile</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(path</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">) {</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> fs</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.readFileSync</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(path);</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">}</span></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// 攻击: readFile(&quot;../../../etc/passwd&quot;)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// 安全: 限制在安全目录</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> readFile</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(relativePath</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">) {</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> safePath</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> path</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.join</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">SAFE_DIR</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> relativePath);</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> resolved</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> path</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.resolve</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(safePath);</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  </span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> (</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">resolved</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.startsWith</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">SAFE_DIR</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">)) {</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">    throw</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Error</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&quot;路径越界访问被拒绝&quot;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">);</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  </span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> fs</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.readFileSync</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(resolved);</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h4 id="_3-速率限制" tabindex="-1">3. 速率限制 <a class="header-anchor" href="#_3-速率限制" aria-label="Permalink to “3. 速率限制”">​</a></h4><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> rateLimiter</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Map</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">&lt;</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">string</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">[]&gt;();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> checkRateLimit</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(clientId</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">)</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> boolean</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> now</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> Date</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.now</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">();</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> window</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 60000</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">; </span><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// 1 分钟</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> maxRequests</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 100</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">;</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  </span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> requests</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> rateLimiter</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.get</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(clientId) </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> [];</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> recentRequests</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> requests</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.filter</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(time </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> now </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> time </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> window);</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  </span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> (</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">recentRequests</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">.</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> &gt;=</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> maxRequests) {</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">; </span><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// 超出限制</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  </span></span>
<span class="line"><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">  recentRequests</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.push</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(now);</span></span>
<span class="line"><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">  rateLimiter</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.set</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(clientId</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> recentRequests);</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">;</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h2 id="进阶话题" tabindex="-1">进阶话题 <a class="header-anchor" href="#进阶话题" aria-label="Permalink to “进阶话题”">​</a></h2><h3 id="动态工具注册" tabindex="-1">动态工具注册 <a class="header-anchor" href="#动态工具注册" aria-label="Permalink to “动态工具注册”">​</a></h3><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// 根据配置动态注册工具</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> enabledTools</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> config</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">.tools; </span><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// [&#39;search&#39;, &#39;summarize&#39;]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> (</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">enabledTools</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.includes</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&#39;search&#39;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">)) {</span></span>
<span class="line"><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">  server</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.registerTool</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&#39;search&#39;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">}</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> handler);</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> (</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">enabledTools</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.includes</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&#39;summarize&#39;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">)) {</span></span>
<span class="line"><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">  server</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.registerTool</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&#39;summarize&#39;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">}</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> handler);</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="工具版本管理" tabindex="-1">工具版本管理 <a class="header-anchor" href="#工具版本管理" aria-label="Permalink to “工具版本管理”">​</a></h3><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">server</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.registerTool</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">  &quot;search_v2&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  {</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    description</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;搜索功能 v2 (支持高级过滤)&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    inputSchema</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">      query</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> z</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.string</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">()</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">      filters</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> z</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.object</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">({</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">        dateRange</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> z</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.string</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">()</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.optional</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">()</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">        category</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> z</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.string</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">()</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.optional</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">()</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">      })</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.optional</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">()</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    }</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  }</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">  async</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> ({ query</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> filters }) </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">    // 新版本实现</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// 保留旧版本兼容性</span></span>
<span class="line"><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">server</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.registerTool</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">  &quot;search&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  {</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    description</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;搜索功能 v1 (已弃用,请使用 search_v2)&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    inputSchema</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">      query</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> z</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.string</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">()</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    }</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  }</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">  async</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> ({ query }) </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">    // 转发到新版本</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> server</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.callTool</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&#39;search_v2&#39;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> { query });</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h3 id="批量操作支持" tabindex="-1">批量操作支持 <a class="header-anchor" href="#批量操作支持" aria-label="Permalink to “批量操作支持”">​</a></h3><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">server</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.registerTool</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">  &quot;batch_process&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  {</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    description</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;批量处理文件&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    inputSchema</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">      files</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> z</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.array</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">z</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.string</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">())</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.min</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#1976D2;--shiki-dark:#F8F8F8;">1</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">)</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.max</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="--shiki-light:#1976D2;--shiki-dark:#F8F8F8;">100</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">)</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">      operation</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> z</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.enum</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">([</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&#39;compress&#39;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &#39;convert&#39;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &#39;analyze&#39;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">])</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    }</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  }</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">  async</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> ({ files</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> operation }) </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> results</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> [];</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    </span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> (</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> file</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> of</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> files) {</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">      try</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">        const</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> result</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> processFile</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(file</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> operation);</span></span>
<span class="line"><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">        results</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.push</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">({ file</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> status</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &#39;success&#39;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> result });</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">      } </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> (error) {</span></span>
<span class="line"><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">        results</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.push</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">({ file</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> status</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &#39;error&#39;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> error</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> error</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">.message });</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    </span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> summary</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">      total</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> files</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">.</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">      success</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> results</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.filter</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(r </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> r</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">.status </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &#39;success&#39;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">).</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">      failed</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> results</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.filter</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(r </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> r</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">.status </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &#39;error&#39;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">).</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    };</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    </span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">      content</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> [{</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">        type</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;text&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">        text</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> `批量处理完成:\n</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">${</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">JSON</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.stringify</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(summary</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 2</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">)</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">}</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">\n\n详细结果:\n</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">${</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;">JSON</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.stringify</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(results</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 2</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">)</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">}</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">`</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">      }]</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    };</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h2 id="相关资源" tabindex="-1">相关资源 <a class="header-anchor" href="#相关资源" aria-label="Permalink to “相关资源”">​</a></h2><h3 id="官方文档" tabindex="-1">官方文档 <a class="header-anchor" href="#官方文档" aria-label="Permalink to “官方文档”">​</a></h3><ul><li><a href="https://spec.modelcontextprotocol.io/" target="_blank" rel="noreferrer">MCP 规范</a></li><li><a href="https://github.com/modelcontextprotocol/typescript-sdk" target="_blank" rel="noreferrer">TypeScript SDK</a></li><li><a href="https://github.com/modelcontextprotocol/python-sdk" target="_blank" rel="noreferrer">Python SDK</a></li><li><a href="https://github.com/modelcontextprotocol/java-sdk" target="_blank" rel="noreferrer">Java SDK</a></li></ul><h3 id="示例代码" tabindex="-1">示例代码 <a class="header-anchor" href="#示例代码" aria-label="Permalink to “示例代码”">​</a></h3><ul><li><a href="https://github.com/modelcontextprotocol/quickstart-resources/tree/main/weather-server-typescript" target="_blank" rel="noreferrer">天气 Server (本教程)</a></li><li><a href="https://github.com/modelcontextprotocol/servers/tree/main/src/filesystem" target="_blank" rel="noreferrer">文件系统 Server</a></li><li><a href="https://github.com/modelcontextprotocol/servers/tree/main/src/sqlite" target="_blank" rel="noreferrer">SQLite Server</a></li><li><a href="https://github.com/modelcontextprotocol/servers/tree/main/src/git" target="_blank" rel="noreferrer">Git Server</a></li><li><a href="https://github.com/modelcontextprotocol/servers" target="_blank" rel="noreferrer">更多官方 Servers</a></li></ul><h3 id="工具与调试" tabindex="-1">工具与调试 <a class="header-anchor" href="#工具与调试" aria-label="Permalink to “工具与调试”">​</a></h3><ul><li><a href="https://github.com/modelcontextprotocol/inspector" target="_blank" rel="noreferrer">MCP Inspector</a> - 交互式调试工具</li><li><a href="https://github.com/modelcontextprotocol/typescript-sdk/tree/main/templates" target="_blank" rel="noreferrer">Server 模板</a></li></ul><h3 id="社区资源" tabindex="-1">社区资源 <a class="header-anchor" href="#社区资源" aria-label="Permalink to “社区资源”">​</a></h3><ul><li><a href="https://github.com/modelcontextprotocol/specification/discussions" target="_blank" rel="noreferrer">GitHub Discussions</a></li><li><a href="https://discord.gg/modelcontextprotocol" target="_blank" rel="noreferrer">Discord 社区</a></li></ul><h2 id="下一步" tabindex="-1">下一步 <a class="header-anchor" href="#下一步" aria-label="Permalink to “下一步”">​</a></h2><p>根据你的需求选择路径:</p><p><strong>我想开发更复杂的 Server</strong> → 查看 <a href="https://github.com/modelcontextprotocol/servers" target="_blank" rel="noreferrer">官方 Servers 源码</a></p><p><strong>我想集成 Server 到应用</strong> → 阅读 <a href="./mcp-client.html">MCP Client 开发指南</a></p><p><strong>我关心安全性</strong> → 阅读 <a href="./mcp-security.html">MCP 认证与安全</a></p><p><strong>我想部署远程 Server</strong> → 研究 <a href="https://spec.modelcontextprotocol.io/specification/2025-11-25/basic/transports/#http-with-sse-transport" target="_blank" rel="noreferrer">HTTP 传输实现</a></p><h2 id="总结" tabindex="-1">总结 <a class="header-anchor" href="#总结" aria-label="Permalink to “总结”">​</a></h2><p>通过本指南,你应该掌握了:</p><p><strong>✓ 概念理解</strong></p><ul><li>MCP Server 的三大核心能力(Tools, Resources, Prompts)</li><li>多 Server 协作模式</li></ul><p><strong>✓ 开发技能</strong></p><ul><li>使用 TypeScript SDK 构建完整 Server</li><li>工具注册、错误处理、日志管理</li></ul><p><strong>✓ 测试与调试</strong></p><ul><li>Claude Desktop 集成配置</li><li>常见问题排查方法</li></ul><p><strong>✓ 最佳实践</strong></p><ul><li>安全编码规范</li><li>性能优化策略</li></ul></div></div></main><footer class="VPDocFooter" data-v-d89afd13 data-v-4a2af9f5><!--[--><!--]--><div class="edit-info" data-v-4a2af9f5><!----><div class="last-updated" data-v-4a2af9f5><p class="VPLastUpdated" data-v-4a2af9f5 data-v-0a1a09f1>最后更新于: <time datetime="2026-02-16T12:42:59.000Z" data-v-0a1a09f1></time></p></div></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-4a2af9f5><span class="visually-hidden" id="doc-footer-aria-label" data-v-4a2af9f5>Pager</span><div class="pager" data-v-4a2af9f5><a class="VPLink link pager-link prev" href="/ai/mcp/mcp-introduction.html" data-v-4a2af9f5><!--[--><span class="desc" data-v-4a2af9f5>上一篇</span><span class="title" data-v-4a2af9f5>MCP 总览</span><!--]--></a></div><div class="pager" data-v-4a2af9f5><a class="VPLink link pager-link next" href="/ai/mcp/mcp-client.html" data-v-4a2af9f5><!--[--><span class="desc" data-v-4a2af9f5>下一篇</span><span class="title" data-v-4a2af9f5>MCP 客户端开发指南</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-d70b1323 data-v-937f3382><div class="container" data-v-937f3382><p class="message" data-v-937f3382>Powered by <a href="https://vitepress.dev/">VitePress</a>. Statics by <a target="_blank" title="51la网站统计" href="https://v6.51.la/land/3ItqjsY11mrrfGg3">51la统计</a></p><p class="copyright" data-v-937f3382>Copyright © 2024 <a href="https://github.com/naico-wang">Naico Wang</a></p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"ai_agent_agent-overview.md\":\"ljd5wbxE\",\"ai_index.md\":\"BQ4i9CCb\",\"ai_mcp_mcp-client.md\":\"C2_3sXsE\",\"ai_mcp_mcp-introduction.md\":\"ayk_k1Ii\",\"ai_mcp_mcp-security.md\":\"B0L4iwfE\",\"ai_mcp_mcp-server.md\":\"OXsBFHtw\",\"ai_vibe-coding_claude-code-guide.md\":\"BeqRxoa0\",\"index.md\":\"D8t8BaNP\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"智库\",\"description\":\"苟利国家生死以，岂因祸福避趋之\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"logo\":{\"light\":\"/images/logo-light.svg\",\"dark\":\"/images/logo-dark.svg\"},\"search\":{\"provider\":\"local\"},\"nav\":[{\"text\":\"首页\",\"link\":\"/\"},{\"text\":\"AI 工程化\",\"link\":\"/ai\"}],\"sidebar\":[{\"text\":\"AI 工程化规范\",\"position\":3,\"items\":[{\"text\":\"模型上下文协议\",\"position\":1,\"items\":[{\"text\":\"MCP 总览\",\"position\":1,\"link\":\"/ai/mcp/mcp-introduction\"},{\"text\":\"MCP 服务端开发指南\",\"position\":2,\"link\":\"/ai/mcp/mcp-server\"},{\"text\":\"MCP 客户端开发指南\",\"position\":3,\"link\":\"/ai/mcp/mcp-client\"},{\"text\":\"MCP 认证与安全\",\"position\":6,\"link\":\"/ai/mcp/mcp-security\"}],\"collapsed\":false},{\"text\":\"人工智能体\",\"position\":2,\"items\":[{\"text\":\"Agent 技术综述\",\"position\":1,\"link\":\"/ai/agent/agent-overview\"}],\"collapsed\":false},{\"text\":\"氛围编程\",\"position\":88,\"items\":[{\"text\":\"Claude Code 使用指南\",\"position\":999,\"link\":\"/ai/vibe-coding/claude-code-guide\"}],\"collapsed\":false}],\"collapsed\":false}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/naico-wang/naico-wang.github.io\"},{\"icon\":\"linkedin\",\"link\":\"https://www.linkedin.com/in/naico-wang-49554891/\"}],\"outline\":{\"label\":\"页面导航\"},\"lastUpdated\":{\"text\":\"最后更新于\",\"formatOptions\":{\"dateStyle\":\"short\",\"timeStyle\":\"short\",\"forceLocale\":true}},\"docFooter\":{\"prev\":\"上一篇\",\"next\":\"下一篇\"},\"footer\":{\"message\":\"Powered by <a href=\\\"https://vitepress.dev/\\\">VitePress</a>. Statics by <a target=\\\"_blank\\\" title=\\\"51la网站统计\\\" href=\\\"https://v6.51.la/land/3ItqjsY11mrrfGg3\\\">51la统计</a>\",\"copyright\":\"Copyright © 2024 <a href=\\\"https://github.com/naico-wang\\\">Naico Wang</a>\"},\"returnToTopLabel\":\"回顶部\",\"sidebarMenuLabel\":\"菜单\",\"externalLinkIcon\":true},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false,\"additionalConfig\":{}}");</script>
    
  </body>
</html>
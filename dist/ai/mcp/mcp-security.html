<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MCP 认证与安全 | 智库</title>
    <meta name="description" content="苟利国家生死以，岂因祸福避趋之">
    <meta name="generator" content="VitePress v2.0.0-alpha.16">
    <link rel="preload stylesheet" href="/assets/style.BiE4VZIv.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.YEGqcI-x.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.B0Esan1z.js">
    <link rel="modulepreload" href="/assets/chunks/framework.NCXUupj9.js">
    <link rel="modulepreload" href="/assets/ai_mcp_mcp-security.md.B0L4iwfE.lean.js">
    <link rel="icon" href="/favicon.ico">
    <meta property="og:type" content="website">
    <meta property="og:title" content="智库">
    <meta property="og:description" content="奶一口智库">
    <meta property="og:image" content="https://naico.wang/icons/icon-logo.png">
    <meta property="og:url" content="https://naico.wang">
    <meta name="referrer" content="no-referrer">
    <script>(function(r){"use strict";(function(a){var s=window,e=document,c=r,o="".concat(e.location.protocol==="https:"?"https://":"http://","sdk.51.la/js-sdk-pro.min.js"),t=e.createElement("script"),i=e.getElementsByTagName("script")[0];t.type="text/javascript",t.setAttribute("charset","UTF-8"),t.async=!0,t.src=o,t.id="LA_COLLECT",c.d=t;var n=function(){s.LA.ids.push(c)};s.LA?s.LA.ids&&n():(s.LA=r,s.LA.ids=[],n()),i.parentNode.insertBefore(t,i)})()})({id:"3ItqjsY11mrrfGg3",ck:"3ItqjsY11mrrfGg3",autoTrack:!0,hashMode:!0});</script>
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-d70b1323><!--[--><!--]--><!--[--><span tabindex="-1" data-v-fb4b3d3a></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-fb4b3d3a>Skip to content</a><!--]--><!----><header class="VPNav" data-v-d70b1323 data-v-eed9f036><div class="VPNavBar has-sidebar top" data-v-eed9f036 data-v-7f879658><div class="wrapper" data-v-7f879658><div class="container" data-v-7f879658><div class="title" data-v-7f879658><div class="VPNavBarTitle has-sidebar" data-v-7f879658 data-v-e2fe915e><a class="title" href="/" data-v-e2fe915e><!--[--><!--]--><!--[--><!--[--><!--[--><img class="VPImage dark logo" src="/images/logo-dark.svg" alt data-v-978bae9a><!--]--><!--[--><img class="VPImage light logo" src="/images/logo-light.svg" alt data-v-978bae9a><!--]--><!--]--><!--]--><span data-v-e2fe915e>智库</span><!--[--><!--]--></a></div></div><div class="content" data-v-7f879658><div class="content-body" data-v-7f879658><!--[--><!--]--><div class="VPNavBarSearch search" data-v-7f879658 data-v-0a1aad85><!--[--><button type="button" class="VPNavBarSearchButton" aria-label="Search" aria-keyshortcuts="/ control+k meta+k" data-v-0a1aad85 data-v-1c830a8e><span class="vpi-search" aria-hidden="true" data-v-1c830a8e></span><span class="text" data-v-1c830a8e>Search</span><span class="keys" aria-hidden="true" data-v-1c830a8e><kbd class="key-cmd" data-v-1c830a8e>⌘</kbd><kbd class="key-ctrl" data-v-1c830a8e>Ctrl</kbd><kbd data-v-1c830a8e>K</kbd></span></button><!----><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-7f879658 data-v-c90e0688><span id="main-nav-aria-label" class="visually-hidden" data-v-c90e0688> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/" tabindex="0" data-v-c90e0688 data-v-4e284e0d><!--[--><span data-v-4e284e0d>首页</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/ai.html" tabindex="0" data-v-c90e0688 data-v-4e284e0d><!--[--><span data-v-4e284e0d>AI 工程化</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-7f879658 data-v-10edae05><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-10edae05 data-v-771d01e9 data-v-146f5a1e><span class="check" data-v-146f5a1e><span class="icon" data-v-146f5a1e><!--[--><span class="vpi-sun sun" data-v-771d01e9></span><span class="vpi-moon moon" data-v-771d01e9></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-7f879658 data-v-4f923422 data-v-1578054f><!--[--><a class="VPSocialLink no-icon" href="https://github.com/naico-wang/naico-wang.github.io" aria-label="github" target="_blank" rel="me noopener" data-v-1578054f data-v-085c7257><span class="vpi-social-github"></span></a><a class="VPSocialLink no-icon" href="https://www.linkedin.com/in/naico-wang-49554891/" aria-label="linkedin" target="_blank" rel="me noopener" data-v-1578054f data-v-085c7257><span class="vpi-social-linkedin"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-7f879658 data-v-6e982ded data-v-b7fe3003><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-b7fe3003><span class="vpi-more-horizontal icon" data-v-b7fe3003></span></button><div class="menu" data-v-b7fe3003><div class="VPMenu" data-v-b7fe3003 data-v-570c90f8><!----><!--[--><!--[--><!----><div class="group" data-v-6e982ded><div class="item appearance" data-v-6e982ded><p class="label" data-v-6e982ded>Appearance</p><div class="appearance-action" data-v-6e982ded><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-6e982ded data-v-771d01e9 data-v-146f5a1e><span class="check" data-v-146f5a1e><span class="icon" data-v-146f5a1e><!--[--><span class="vpi-sun sun" data-v-771d01e9></span><span class="vpi-moon moon" data-v-771d01e9></span><!--]--></span></span></button></div></div></div><div class="group" data-v-6e982ded><div class="item social-links" data-v-6e982ded><div class="VPSocialLinks social-links-list" data-v-6e982ded data-v-1578054f><!--[--><a class="VPSocialLink no-icon" href="https://github.com/naico-wang/naico-wang.github.io" aria-label="github" target="_blank" rel="me noopener" data-v-1578054f data-v-085c7257><span class="vpi-social-github"></span></a><a class="VPSocialLink no-icon" href="https://www.linkedin.com/in/naico-wang-49554891/" aria-label="linkedin" target="_blank" rel="me noopener" data-v-1578054f data-v-085c7257><span class="vpi-social-linkedin"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-7f879658 data-v-61d15f3e><span class="container" data-v-61d15f3e><span class="top" data-v-61d15f3e></span><span class="middle" data-v-61d15f3e></span><span class="bottom" data-v-61d15f3e></span></span></button></div></div></div></div><div class="divider" data-v-7f879658><div class="divider-line" data-v-7f879658></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-d70b1323 data-v-4d794240><div class="container" data-v-4d794240><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-4d794240><span class="vpi-align-left menu-icon" data-v-4d794240></span><span class="menu-text" data-v-4d794240>菜单</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-4d794240 data-v-1b4724e4><button data-v-1b4724e4>回顶部</button><!----></div></div></div><aside class="VPSidebar" data-v-d70b1323 data-v-286bab1d><div class="curtain" data-v-286bab1d></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-286bab1d><span class="visually-hidden" id="sidebar-aria-label" data-v-286bab1d> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-46e4b36c><section class="VPSidebarItem level-0 collapsible has-active" data-v-46e4b36c data-v-b44a99a2><div class="item" role="button" tabindex="0" data-v-b44a99a2><div class="indicator" data-v-b44a99a2></div><h2 class="text" data-v-b44a99a2>AI 工程化规范</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b44a99a2><span class="vpi-chevron-right caret-icon" data-v-b44a99a2></span></div></div><div class="items" data-v-b44a99a2><!--[--><section class="VPSidebarItem level-1 collapsible has-active" data-v-b44a99a2 data-v-b44a99a2><div class="item" role="button" tabindex="0" data-v-b44a99a2><div class="indicator" data-v-b44a99a2></div><h3 class="text" data-v-b44a99a2>模型上下文协议</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b44a99a2><span class="vpi-chevron-right caret-icon" data-v-b44a99a2></span></div></div><div class="items" data-v-b44a99a2><!--[--><div class="VPSidebarItem level-2 is-link" data-v-b44a99a2 data-v-b44a99a2><div class="item" data-v-b44a99a2><div class="indicator" data-v-b44a99a2></div><a class="VPLink link link" href="/ai/mcp/mcp-introduction.html" data-v-b44a99a2><!--[--><p class="text" data-v-b44a99a2>MCP 总览</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b44a99a2 data-v-b44a99a2><div class="item" data-v-b44a99a2><div class="indicator" data-v-b44a99a2></div><a class="VPLink link link" href="/ai/mcp/mcp-server.html" data-v-b44a99a2><!--[--><p class="text" data-v-b44a99a2>MCP 服务端开发指南</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b44a99a2 data-v-b44a99a2><div class="item" data-v-b44a99a2><div class="indicator" data-v-b44a99a2></div><a class="VPLink link link" href="/ai/mcp/mcp-client.html" data-v-b44a99a2><!--[--><p class="text" data-v-b44a99a2>MCP 客户端开发指南</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b44a99a2 data-v-b44a99a2><div class="item" data-v-b44a99a2><div class="indicator" data-v-b44a99a2></div><a class="VPLink link link" href="/ai/mcp/mcp-security.html" data-v-b44a99a2><!--[--><p class="text" data-v-b44a99a2>MCP 认证与安全</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1 collapsible" data-v-b44a99a2 data-v-b44a99a2><div class="item" role="button" tabindex="0" data-v-b44a99a2><div class="indicator" data-v-b44a99a2></div><h3 class="text" data-v-b44a99a2>人工智能体</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b44a99a2><span class="vpi-chevron-right caret-icon" data-v-b44a99a2></span></div></div><div class="items" data-v-b44a99a2><!--[--><div class="VPSidebarItem level-2 is-link" data-v-b44a99a2 data-v-b44a99a2><div class="item" data-v-b44a99a2><div class="indicator" data-v-b44a99a2></div><a class="VPLink link link" href="/ai/agent/agent-overview.html" data-v-b44a99a2><!--[--><p class="text" data-v-b44a99a2>Agent 技术综述</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1 collapsible" data-v-b44a99a2 data-v-b44a99a2><div class="item" role="button" tabindex="0" data-v-b44a99a2><div class="indicator" data-v-b44a99a2></div><h3 class="text" data-v-b44a99a2>氛围编程</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b44a99a2><span class="vpi-chevron-right caret-icon" data-v-b44a99a2></span></div></div><div class="items" data-v-b44a99a2><!--[--><div class="VPSidebarItem level-2 is-link" data-v-b44a99a2 data-v-b44a99a2><div class="item" data-v-b44a99a2><div class="indicator" data-v-b44a99a2></div><a class="VPLink link link" href="/ai/vibe-coding/claude-code-guide.html" data-v-b44a99a2><!--[--><p class="text" data-v-b44a99a2>Claude Code 使用指南</p><!--]--></a><!----></div><!----></div><!--]--></div></section><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-d70b1323 data-v-6843e7e5><div class="VPDoc has-sidebar has-aside" data-v-6843e7e5 data-v-d89afd13><!--[--><!--]--><div class="container" data-v-d89afd13><div class="aside" data-v-d89afd13><div class="aside-curtain" data-v-d89afd13></div><div class="aside-container" data-v-d89afd13><div class="aside-content" data-v-d89afd13><div class="VPDocAside" data-v-d89afd13 data-v-d95d9c8d><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-d95d9c8d data-v-436840d7><div class="content" data-v-436840d7><div class="outline-marker" data-v-436840d7></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-436840d7>页面导航</div><ul class="VPDocOutlineItem root" data-v-436840d7 data-v-54152346><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-d95d9c8d></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-d89afd13><div class="content-container" data-v-d89afd13><!--[--><!--]--><main class="main" data-v-d89afd13><div style="position:relative;" class="vp-doc _ai_mcp_mcp-security external-link-icon-enabled" data-v-d89afd13><div><h1 id="mcp-认证与安全最佳实践" tabindex="-1">MCP 认证与安全最佳实践 <a class="header-anchor" href="#mcp-认证与安全最佳实践" aria-label="Permalink to “MCP 认证与安全最佳实践”">​</a></h1><blockquote><p>本文档面向 MCP（Model Context Protocol）系统，提供系统化的安全威胁分析、攻击向量说明与可落地的防护实践指南。</p></blockquote><h2 id="_1-文档目的与适用范围" tabindex="-1">1. 文档目的与适用范围 <a class="header-anchor" href="#_1-文档目的与适用范围" aria-label="Permalink to “1. 文档目的与适用范围”">​</a></h2><h3 id="_1-1-目的" tabindex="-1">1.1 目的 <a class="header-anchor" href="#_1-1-目的" aria-label="Permalink to “1.1 目的”">​</a></h3><p>本文档旨在：</p><ul><li><strong>识别安全风险</strong> — 系统性梳理 MCP 在授权、令牌、会话、本地执行等方面的特有安全威胁</li><li><strong>提供防护指南</strong> — 结合 OAuth 2.1 / OIDC / RFC 规范，给出可执行、可审计的安全最佳实践</li><li><strong>建立统一标准</strong> — 为团队提供一致的安全开发与评审参考</li></ul><h3 id="_1-2-适用角色" tabindex="-1">1.2 适用角色 <a class="header-anchor" href="#_1-2-适用角色" aria-label="Permalink to “1.2 适用角色”">​</a></h3><table tabindex="0"><thead><tr><th>角色</th><th>关注重点</th></tr></thead><tbody><tr><td>MCP Server / Proxy 实现者</td><td>授权流程实现、令牌校验、攻击面防护</td></tr><tr><td>MCP Client / Host Application 开发者</td><td>客户端安全配置、令牌管理、用户同意流程</td></tr><tr><td>安全评估与合规审计人员</td><td>威胁模型、安全检查清单、合规映射</td></tr></tbody></table><h3 id="_1-3-前置知识" tabindex="-1">1.3 前置知识 <a class="header-anchor" href="#_1-3-前置知识" aria-label="Permalink to “1.3 前置知识”">​</a></h3><p>阅读本文档前，建议先了解以下规范：</p><ul><li><a href="https://spec.modelcontextprotocol.io/specification/2025-03-26/basic/authorization/" target="_blank" rel="noreferrer">MCP Authorization Specification</a></li><li><a href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-v2-1-13" target="_blank" rel="noreferrer">OAuth 2.1（draft-ietf-oauth-v2-1）</a></li><li><a href="https://datatracker.ietf.org/doc/html/rfc9700" target="_blank" rel="noreferrer">RFC 9700 — OAuth 2.0 Security Best Practices</a></li></ul><h2 id="_2-mcp-授权模型概览" tabindex="-1">2. MCP 授权模型概览 <a class="header-anchor" href="#_2-mcp-授权模型概览" aria-label="Permalink to “2. MCP 授权模型概览”">​</a></h2><p>在 MCP 架构中，授权的核心目标是：</p><ul><li>保护 MCP Server 暴露的 <strong>工具（Tools）</strong> 与 <strong>资源（Resources）</strong></li><li>明确 <code>谁</code> 在 <code>什么上下文</code> 下执行了 <code>哪些操作</code></li></ul><h3 id="_2-1-设计原则" tabindex="-1">2.1 设计原则 <a class="header-anchor" href="#_2-1-设计原则" aria-label="Permalink to “2.1 设计原则”">​</a></h3><p>MCP 的授权模型遵循以下原则：</p><table tabindex="0"><thead><tr><th>原则</th><th>说明</th></tr></thead><tbody><tr><td>不绑定特定身份系统</td><td>OIDC、企业 IdP、SaaS OAuth 均可作为上游身份源</td></tr><tr><td>严格遵循 OAuth 2.1</td><td>强制 PKCE，禁止隐式流（Implicit Flow）</td></tr><tr><td>标准发现机制</td><td>通过 RFC 9728（Protected Resource Metadata）和 <br>RFC 8414（Authorization Server Metadata）建立信任</td></tr></tbody></table><p><strong>关键认知</strong>：MCP 本身不是自定义认证协议，而是 OAuth 体系中的 <strong>受保护资源（Protected Resource）</strong>。MCP Server 的角色等同于 OAuth 资源服务器。</p><h3 id="_2-2-何时必须启用授权" tabindex="-1">2.2 何时必须启用授权 <a class="header-anchor" href="#_2-2-何时必须启用授权" aria-label="Permalink to “2.2 何时必须启用授权”">​</a></h3><p>MCP Server 可以匿名运行，但在以下任一场景中，<strong>授权是强制要求</strong>：</p><ul><li>访问用户私有数据或租户隔离数据（文档、邮件、数据库）</li><li>涉及管理类或破坏性操作（删除、修改配置等）</li><li>需要审计、计费、速率限制或配额控制</li><li>代理第三方 API（OAuth Delegation 场景）</li><li>企业或合规环境（SOC 2、ISO 27001、GDPR）</li></ul><h3 id="_2-3-本地-mcp-server-的特殊说明" tabindex="-1">2.3 本地 MCP Server 的特殊说明 <a class="header-anchor" href="#_2-3-本地-mcp-server-的特殊说明" aria-label="Permalink to “2.3 本地 MCP Server 的特殊说明”">​</a></h3><p>使用 <code>stdio</code> 传输的本地 MCP Server 不走 HTTP，因此 OAuth 流程不直接适用。此类场景的凭证管理方式包括：</p><ul><li><strong>环境变量</strong> — 通过 <code>MCP_API_KEY</code> 等环境变量传递凭证</li><li><strong>系统凭证存储</strong> — 使用 macOS Keychain、Windows Credential Manager 或 Linux Secret Service</li><li><strong>配置文件</strong> — 加密存储于本地配置文件中（需控制文件权限为 <code>600</code>）</li></ul><blockquote><p>OAuth 授权流程主要适用于 <strong>远程、HTTP 传输的 MCP Server</strong>。</p></blockquote><h2 id="_3-mcp-标准授权流程-oauth-2-1" tabindex="-1">3. MCP 标准授权流程（OAuth 2.1） <a class="header-anchor" href="#_3-mcp-标准授权流程-oauth-2-1" aria-label="Permalink to “3. MCP 标准授权流程（OAuth 2.1）”">​</a></h2><p>本节以端到端视角说明 MCP Client 首次访问受保护 MCP Server 的完整流程。</p><!----><h3 id="_3-1-初始握手-401-challenge" tabindex="-1">3.1 初始握手（401 Challenge） <a class="header-anchor" href="#_3-1-初始握手-401-challenge" aria-label="Permalink to “3.1 初始握手（401 Challenge）”">​</a></h3><p>当 MCP Client 首次发起未认证请求时，MCP Server 返回 <code>401 Unauthorized</code>，并通过 <code>WWW-Authenticate</code> 头指向 Protected Resource Metadata（PRM）：</p><div class="language-http line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">http</span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">HTTP</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">/</span><span style="--shiki-light:#1976D2;--shiki-dark:#F8F8F8;">1.1</span><span style="--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 401</span><span style="--shiki-light:#2B5581;--shiki-dark:#9DB1C5;"> Unauthorized</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">WWW-Authenticate</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#2B5581;--shiki-dark:#9DB1C5;"> Bearer realm=&quot;mcp&quot;,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  resource_metadata=&quot;https://mcp.example.com/.well-known/oauth-protected-resource&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>安全要求</strong>：</p><ul><li><strong>禁止泄露实现细节</strong> — 401 响应中不得包含服务器版本、框架信息等</li><li><strong>强制 HTTPS</strong> — PRM URL 必须为 HTTPS 协议</li><li><strong>限制响应头</strong> — 不在错误响应中暴露内部路径或调试信息</li></ul><h3 id="_3-2-受保护资源元数据-rfc-9728" tabindex="-1">3.2 受保护资源元数据（RFC 9728） <a class="header-anchor" href="#_3-2-受保护资源元数据-rfc-9728" aria-label="Permalink to “3.2 受保护资源元数据（RFC 9728）”">​</a></h3><p>PRM 文档描述了 MCP Server 的授权边界，客户端通过该文档了解如何获取访问权限：</p><div class="language-json line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">{</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;resource&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;https://mcp.example.com/mcp&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;authorization_servers&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> [</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&quot;https://auth.example.com&quot;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">]</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;scopes_supported&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> [</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&quot;mcp:tools:read&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;mcp:tools:execute&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;mcp:resources:read&quot;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">]</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;bearer_methods_supported&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> [</span><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">&quot;header&quot;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">]</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>最佳实践</strong>：</p><ul><li><code>scopes_supported</code> 仅暴露最小且稳定的作用域集合</li><li>避免使用通配符作用域（如 <code>*</code> 或 <code>all</code>）</li><li>作用域命名采用 <code>namespace:resource:action</code> 格式，语义清晰</li></ul><h3 id="_3-3-授权服务器发现-rfc-8414" tabindex="-1">3.3 授权服务器发现（RFC 8414） <a class="header-anchor" href="#_3-3-授权服务器发现-rfc-8414" aria-label="Permalink to “3.3 授权服务器发现（RFC 8414）”">​</a></h3><p>客户端根据 PRM 中的 <code>authorization_servers</code> 地址，通过标准 Discovery Endpoint 获取授权服务器配置：</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span>GET https://auth.example.com/.well-known/oauth-authorization-server</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>返回的关键端点包括：</p><table tabindex="0"><thead><tr><th>端点</th><th>用途</th></tr></thead><tbody><tr><td><code>authorization_endpoint</code></td><td>用户授权入口</td></tr><tr><td><code>token_endpoint</code></td><td>令牌交换</td></tr><tr><td><code>registration_endpoint</code></td><td>动态客户端注册（可选）</td></tr></tbody></table><blockquote><p><strong>安全提示</strong>：此阶段是 SSRF 攻击的高危入口，防护措施见 <a href="#_53-ssrf服务端请求伪造">5.3 节</a>。</p></blockquote><h3 id="_3-4-客户端注册" tabindex="-1">3.4 客户端注册 <a class="header-anchor" href="#_3-4-客户端注册" aria-label="Permalink to “3.4 客户端注册”">​</a></h3><p>MCP 支持两种客户端注册模式：</p><p><strong>预注册（推荐用于企业/内部系统）</strong></p><ul><li>客户端信息预先录入授权服务器</li><li><code>client_id</code> 和 <code>client_secret</code> 通过安全通道分发</li><li>适用于可控环境，安全性更高</li></ul><p><strong>动态客户端注册（DCR）</strong></p><ul><li>遵循 RFC 7591，客户端运行时自注册</li><li>适用于开放生态或不可预知客户端的场景</li></ul><p><strong>DCR 安全要求</strong>：</p><ul><li>严格校验 <code>redirect_uris</code>，仅允许 HTTPS 且精确匹配（禁止通配符）</li><li>记录并审计 <code>client_id</code> ↔ <code>owner</code> ↔ <code>scopes</code> 的映射关系</li><li>设置注册频率限制，防止滥用</li><li>可选要求 <code>software_statement</code>（签名的客户端声明）</li></ul><h3 id="_3-5-用户授权-authorization-code-pkce" tabindex="-1">3.5 用户授权（Authorization Code + PKCE） <a class="header-anchor" href="#_3-5-用户授权-authorization-code-pkce" aria-label="Permalink to “3.5 用户授权（Authorization Code + PKCE）”">​</a></h3><p>MCP 强制使用 Authorization Code Flow + PKCE，具体要求：</p><table tabindex="0"><thead><tr><th>要求</th><th>说明</th></tr></thead><tbody><tr><td>强制 PKCE</td><td>使用 <code>S256</code> 方法，禁止 <code>plain</code></td></tr><tr><td>禁止隐式流</td><td>不允许 <code>response_type=token</code></td></tr><tr><td>明确同意内容</td><td>授权页面须展示请求的 scope 和 redirect_uri</td></tr><tr><td>state 参数</td><td>必须使用 CSPRNG 生成，防止 CSRF</td></tr></tbody></table><h3 id="_3-6-携带令牌访问-mcp-server" tabindex="-1">3.6 携带令牌访问 MCP Server <a class="header-anchor" href="#_3-6-携带令牌访问-mcp-server" aria-label="Permalink to “3.6 携带令牌访问 MCP Server”">​</a></h3><p>获取令牌后，客户端通过 <code>Authorization</code> 头携带令牌访问 MCP Server：</p><div class="language-http line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">http</span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">GET</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> /mcp/tools/list </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">HTTP</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">/</span><span style="--shiki-light:#1976D2;--shiki-dark:#F8F8F8;">1.1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">Host</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#2B5581;--shiki-dark:#9DB1C5;"> mcp.example.com</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#FFAB70;">Authorization</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#2B5581;--shiki-dark:#9DB1C5;"> Bearer &lt;access_token&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>MCP Server 必须执行以下校验</strong>：</p><ol><li><strong>签名校验</strong> — 验证令牌签名的完整性（JWT 场景下验证 JWS 签名）</li><li><strong>签发者校验</strong> — 验证 <code>iss</code> claim 与预期授权服务器一致</li><li><strong>受众校验</strong> — 验证 <code>aud</code> claim 包含当前 MCP Server 的标识</li><li><strong>有效期校验</strong> — 验证 <code>exp</code> 未过期，<code>nbf</code> 已生效</li><li><strong>权限校验</strong> — 将令牌中的 <code>scope</code> 映射到实际的工具/资源访问权限</li></ol><h2 id="_4-令牌管理" tabindex="-1">4. 令牌管理 <a class="header-anchor" href="#_4-令牌管理" aria-label="Permalink to “4. 令牌管理”">​</a></h2><h3 id="_4-1-令牌类型与用途" tabindex="-1">4.1 令牌类型与用途 <a class="header-anchor" href="#_4-1-令牌类型与用途" aria-label="Permalink to “4.1 令牌类型与用途”">​</a></h3><table tabindex="0"><thead><tr><th>令牌类型</th><th>用途</th><th>生命周期</th><th>存储要求</th></tr></thead><tbody><tr><td>Access Token</td><td>访问 MCP Server 资源</td><td>短期（15–60 分钟）</td><td>内存存储，不持久化</td></tr><tr><td>Refresh Token</td><td>续签 Access Token</td><td>中期（数小时至数天）</td><td>加密存储，绑定客户端</td></tr><tr><td>Authorization Code</td><td>一次性令牌交换</td><td>极短（10 分钟内）</td><td>使用后立即作废</td></tr></tbody></table><h3 id="_4-2-令牌生命周期管理" tabindex="-1">4.2 令牌生命周期管理 <a class="header-anchor" href="#_4-2-令牌生命周期管理" aria-label="Permalink to “4.2 令牌生命周期管理”">​</a></h3><p><strong>签发阶段</strong>：</p><ul><li>Access Token 有效期不超过 60 分钟</li><li>Refresh Token 实施轮转（Rotation），每次使用后签发新 Refresh Token 并作废旧令牌</li><li>所有令牌必须绑定 <code>client_id</code>，Refresh Token 还应绑定 <code>user_id</code></li></ul><p><strong>使用阶段</strong>：</p><ul><li>客户端在 Access Token 过期前主动刷新，避免中断</li><li>遇到 <code>401</code> 响应时，先尝试刷新令牌，而非重新触发授权流程</li><li>禁止在 URL 查询参数中传递令牌</li></ul><p><strong>撤销阶段</strong>：</p><ul><li>支持主动撤销（RFC 7009 Token Revocation）</li><li>用户取消授权时，同时撤销关联的所有 Access Token 和 Refresh Token</li><li>检测到安全异常时，支持批量撤销指定客户端的所有令牌</li></ul><h2 id="_5-关键攻击向量与防护" tabindex="-1">5. 关键攻击向量与防护 <a class="header-anchor" href="#_5-关键攻击向量与防护" aria-label="Permalink to “5. 关键攻击向量与防护”">​</a></h2><p>本节系统性地分析 MCP 场景下的主要安全威胁，每个攻击向量包含风险描述、影响范围和防护措施。</p><h3 id="_5-1-混淆代理攻击-confused-deputy" tabindex="-1">5.1 混淆代理攻击（Confused Deputy） <a class="header-anchor" href="#_5-1-混淆代理攻击-confused-deputy" aria-label="Permalink to “5.1 混淆代理攻击（Confused Deputy）”">​</a></h3><h4 id="风险描述" tabindex="-1">风险描述 <a class="header-anchor" href="#风险描述" aria-label="Permalink to “风险描述”">​</a></h4><p>MCP Proxy 同时充当多个角色：</p><ul><li>面向多个 MCP Client 的 OAuth Client</li><li>面向第三方 API 的单一 OAuth Client</li></ul><p>如果<strong>同意边界未隔离</strong>，攻击者可利用一个客户端的授权执行另一个客户端的操作，导致越权访问。</p><h4 id="攻击示例" tabindex="-1">攻击示例 <a class="header-anchor" href="#攻击示例" aria-label="Permalink to “攻击示例”">​</a></h4><!----><h4 id="防护措施" tabindex="-1">防护措施 <a class="header-anchor" href="#防护措施" aria-label="Permalink to “防护措施”">​</a></h4><table tabindex="0"><thead><tr><th>措施</th><th>说明</th></tr></thead><tbody><tr><td>逐客户端独立同意</td><td>每个 <code>client_id</code> 必须独立完成授权同意流程</td></tr><tr><td>同意前置校验</td><td>同意必须在转发到第三方 API <strong>之前</strong>完成</td></tr><tr><td>redirect_uri 精确匹配</td><td>禁止模糊匹配或通配符</td></tr><tr><td>state 参数绑定</td><td><code>state</code> 仅在用户完成同意后生成，并绑定到具体的 <code>client_id</code></td></tr></tbody></table><p><strong>核心原则</strong>：第三方 API 的授权凭据不等于 MCP Client 的授权，两者必须严格隔离。</p><h3 id="_5-2-令牌传递攻击-token-forwarding" tabindex="-1">5.2 令牌传递攻击（Token Forwarding） <a class="header-anchor" href="#_5-2-令牌传递攻击-token-forwarding" aria-label="Permalink to “5.2 令牌传递攻击（Token Forwarding）”">​</a></h3><h4 id="风险描述-1" tabindex="-1">风险描述 <a class="header-anchor" href="#风险描述-1" aria-label="Permalink to “风险描述”">​</a></h4><p>MCP Server 接受并使用「不是为自己签发」的令牌来访问下游服务，导致令牌被跨边界滥用。</p><h4 id="明确禁止" tabindex="-1">明确禁止 <a class="header-anchor" href="#明确禁止" aria-label="Permalink to “明确禁止”">​</a></h4><ul><li>禁止将客户端传入的 Access Token 原样转发给下游 API</li><li>禁止 MCP Server 接受 <code>aud</code> 不包含自身标识的令牌</li></ul><h4 id="正确的下游调用模式" tabindex="-1">正确的下游调用模式 <a class="header-anchor" href="#正确的下游调用模式" aria-label="Permalink to “正确的下游调用模式”">​</a></h4><p>当 MCP Server 需要代表用户调用下游服务时，应使用以下标准机制：</p><table tabindex="0"><thead><tr><th>机制</th><th>适用场景</th><th>规范</th></tr></thead><tbody><tr><td>Token Exchange</td><td>将用户令牌交换为下游服务专用令牌</td><td>RFC 8693</td></tr><tr><td>On-Behalf-Of（OBO）</td><td>以用户身份调用下游服务</td><td>Azure AD OBO / 类似机制</td></tr><tr><td>Client Credentials</td><td>MCP Server 以自身身份调用下游服务</td><td>OAuth 2.1</td></tr></tbody></table><h3 id="_5-3-ssrf-服务端请求伪造" tabindex="-1">5.3 SSRF（服务端请求伪造） <a class="header-anchor" href="#_5-3-ssrf-服务端请求伪造" aria-label="Permalink to “5.3 SSRF（服务端请求伪造）”">​</a></h3><h4 id="风险描述-2" tabindex="-1">风险描述 <a class="header-anchor" href="#风险描述-2" aria-label="Permalink to “风险描述”">​</a></h4><p>在 OAuth 元数据发现阶段，MCP Client 或 Proxy 需要获取多个远程 URL。攻击者可通过篡改元数据中的 URL，诱导服务端向内部网络发起请求。</p><h4 id="高危入口" tabindex="-1">高危入口 <a class="header-anchor" href="#高危入口" aria-label="Permalink to “高危入口”">​</a></h4><p>以下字段中的 URL 均为 SSRF 攻击面：</p><ul><li><code>resource_metadata</code>（PRM 文档地址）</li><li><code>authorization_servers</code>（授权服务器地址）</li><li><code>token_endpoint</code> / <code>authorization_endpoint</code>（具体端点）</li></ul><h4 id="防护措施-1" tabindex="-1">防护措施 <a class="header-anchor" href="#防护措施-1" aria-label="Permalink to “防护措施”">​</a></h4><!----><p><strong>必须执行的防护</strong>：</p><ol><li><strong>强制 HTTPS</strong> — 所有元数据 URL 必须为 HTTPS 协议</li><li><strong>阻断私有 IP</strong> — DNS 解析后校验目标 IP，阻断 RFC 1918 私有地址和链路本地地址（169.254.0.0/16）</li><li><strong>校验重定向链</strong> — 对 HTTP 重定向的每一跳都执行 IP 校验</li><li><strong>使用出口代理</strong> — 通过 Smokescreen 等出口代理统一管控外部请求</li><li><strong>设置超时</strong> — 对元数据获取请求设置严格的超时限制（建议 5 秒）</li></ol><h3 id="_5-4-会话劫持与事件注入" tabindex="-1">5.4 会话劫持与事件注入 <a class="header-anchor" href="#_5-4-会话劫持与事件注入" aria-label="Permalink to “5.4 会话劫持与事件注入”">​</a></h3><h4 id="风险描述-3" tabindex="-1">风险描述 <a class="header-anchor" href="#风险描述-3" aria-label="Permalink to “风险描述”">​</a></h4><p>MCP 基于长连接（SSE / WebSocket）通信，如果会话管理不当，攻击者可能劫持会话或注入恶意事件。</p><h4 id="核心原则" tabindex="-1">核心原则 <a class="header-anchor" href="#核心原则" aria-label="Permalink to “核心原则”">​</a></h4><p><strong>会话不等于身份</strong>。会话标识符仅用于关联连接状态，不能作为唯一的鉴权依据。每个请求都必须独立验证授权。</p><h4 id="防护措施-2" tabindex="-1">防护措施 <a class="header-anchor" href="#防护措施-2" aria-label="Permalink to “防护措施”">​</a></h4><table tabindex="0"><thead><tr><th>措施</th><th>说明</th></tr></thead><tbody><tr><td>session_id 生成</td><td>使用 CSPRNG（密码学安全随机数生成器），长度不低于 128 位</td></tr><tr><td>绑定用户身份</td><td><code>session_id</code> 与 <code>user_id</code>、<code>client_id</code> 绑定，防止会话漂移</td></tr><tr><td>独立鉴权</td><td>不使用 session 作为唯一鉴权手段，每个请求仍需校验 Bearer Token</td></tr><tr><td>事件来源校验</td><td>SSE / WebSocket 消息需校验来源，防止注入伪造事件</td></tr><tr><td>会话超时</td><td>设置空闲超时（建议 30 分钟）和绝对超时（建议 24 小时）</td></tr></tbody></table><h3 id="_5-5-本地-mcp-server-安全" tabindex="-1">5.5 本地 MCP Server 安全 <a class="header-anchor" href="#_5-5-本地-mcp-server-安全" aria-label="Permalink to “5.5 本地 MCP Server 安全”">​</a></h3><h4 id="风险描述-4" tabindex="-1">风险描述 <a class="header-anchor" href="#风险描述-4" aria-label="Permalink to “风险描述”">​</a></h4><p>本地 MCP Server 以用户权限在本机运行，具有直接访问文件系统、执行命令和网络通信的能力，风险等级高于远程服务。</p><h4 id="核心威胁" tabindex="-1">核心威胁 <a class="header-anchor" href="#核心威胁" aria-label="Permalink to “核心威胁”">​</a></h4><table tabindex="0"><thead><tr><th>威胁</th><th>说明</th></tr></thead><tbody><tr><td>任意代码执行</td><td>恶意 MCP Server 可在用户权限下执行任意命令</td></tr><tr><td>权限继承</td><td>MCP Server 继承宿主进程的全部权限（文件、网络、环境变量）</td></tr><tr><td>数据外泄</td><td>读取本地敏感文件后通过网络外传（如 SSH 密钥、凭证文件）</td></tr><tr><td>供应链攻击</td><td>通过 npm/pip 等包管理器安装的恶意 MCP Server 包</td></tr></tbody></table><h4 id="客户端-host-application-安全要求" tabindex="-1">客户端（Host Application）安全要求 <a class="header-anchor" href="#客户端-host-application-安全要求" aria-label="Permalink to “客户端（Host Application）安全要求”">​</a></h4><ol><li><strong>命令预览</strong> — 执行前向用户完整展示将要执行的命令或操作</li><li><strong>风险提示</strong> — 对文件写入、命令执行、网络请求等敏感操作给出明确风险提示</li><li><strong>用户显式确认</strong> — 敏感操作必须经过用户明确的确认（不可静默执行）</li><li><strong>来源审计</strong> — 记录 MCP Server 的来源、版本和哈希值</li></ol><h4 id="服务端安全建议" tabindex="-1">服务端安全建议 <a class="header-anchor" href="#服务端安全建议" aria-label="Permalink to “服务端安全建议”">​</a></h4><ol><li><strong>优先使用 stdio 传输</strong> — 避免暴露网络端口</li><li><strong>最小权限运行</strong> — 使用专用低权限用户运行，避免 root / admin</li><li><strong>沙箱隔离</strong> — 使用 Docker 容器、macOS Sandbox 或 Linux namespace 限制文件系统和网络访问</li><li><strong>限制出站网络</strong> — 如非必要，禁止 MCP Server 发起外部网络请求</li></ol><h3 id="_5-6-作用域设计-scope-design" tabindex="-1">5.6 作用域设计（Scope Design） <a class="header-anchor" href="#_5-6-作用域设计-scope-design" aria-label="Permalink to “5.6 作用域设计（Scope Design）”">​</a></h3><h4 id="设计原则" tabindex="-1">设计原则 <a class="header-anchor" href="#设计原则" aria-label="Permalink to “设计原则”">​</a></h4><table tabindex="0"><thead><tr><th>原则</th><th>说明</th></tr></thead><tbody><tr><td>最小初始权限</td><td>初始授权仅包含完成当前操作所需的最小 scope</td></tr><tr><td>按需提升</td><td>需要额外权限时，通过增量授权（Incremental Authorization）请求</td></tr><tr><td>语义明确</td><td>每个 scope 对应明确的资源和操作，用户可理解其含义</td></tr></tbody></table><h4 id="推荐的-scope-命名规范" tabindex="-1">推荐的 Scope 命名规范 <a class="header-anchor" href="#推荐的-scope-命名规范" aria-label="Permalink to “推荐的 Scope 命名规范”">​</a></h4><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes min-light min-dark" style="--shiki-light:#24292eff;--shiki-dark:#b392f0;--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;" tabindex="0" dir="ltr"><code><span class="line"><span>mcp:tools:read        # 列出可用工具</span></span>
<span class="line"><span>mcp:tools:execute     # 执行工具调用</span></span>
<span class="line"><span>mcp:resources:read    # 读取资源</span></span>
<span class="line"><span>mcp:resources:write   # 写入资源</span></span>
<span class="line"><span>mcp:prompts:read      # 读取提示模板</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="反模式-必须避免" tabindex="-1">反模式（必须避免） <a class="header-anchor" href="#反模式-必须避免" aria-label="Permalink to “反模式（必须避免）”">​</a></h4><table tabindex="0"><thead><tr><th>反模式</th><th>风险</th></tr></thead><tbody><tr><td>使用 <code>*</code> 或 <code>all</code> 作为 scope</td><td>授予无限权限，违反最小权限原则</td></tr><tr><td>预授权未来能力</td><td>当前未使用的 scope 不应预先授予</td></tr><tr><td>scope 不做服务端校验</td><td>scope 仅声明意图，MCP Server 必须独立校验实际权限</td></tr></tbody></table><h2 id="_6-安全检查清单" tabindex="-1">6. 安全检查清单 <a class="header-anchor" href="#_6-安全检查清单" aria-label="Permalink to “6. 安全检查清单”">​</a></h2><p>以下检查清单可用于开发自检和安全评审。</p><h3 id="_6-1-授权与认证" tabindex="-1">6.1 授权与认证 <a class="header-anchor" href="#_6-1-授权与认证" aria-label="Permalink to “6.1 授权与认证”">​</a></h3><ul><li>[ ] 所有远程 MCP Server 均启用 OAuth 2.1 授权</li><li>[ ] 强制使用 PKCE（<code>S256</code> 方法）</li><li>[ ] 禁用隐式流（Implicit Flow）</li><li>[ ] <code>redirect_uri</code> 精确匹配，无通配符</li><li>[ ] <code>state</code> 参数使用 CSPRNG 生成</li></ul><h3 id="_6-2-令牌安全" tabindex="-1">6.2 令牌安全 <a class="header-anchor" href="#_6-2-令牌安全" aria-label="Permalink to “6.2 令牌安全”">​</a></h3><ul><li>[ ] Access Token 有效期不超过 60 分钟</li><li>[ ] Refresh Token 实施轮转（Rotation）</li><li>[ ] MCP Server 校验令牌的 <code>iss</code>、<code>aud</code>、<code>exp</code>、<code>scope</code></li><li>[ ] 禁止原样转发令牌到下游服务</li><li>[ ] 支持令牌主动撤销（RFC 7009）</li></ul><h3 id="_6-3-网络安全" tabindex="-1">6.3 网络安全 <a class="header-anchor" href="#_6-3-网络安全" aria-label="Permalink to “6.3 网络安全”">​</a></h3><ul><li>[ ] 所有元数据 URL 强制 HTTPS</li><li>[ ] 实施 SSRF 防护（私有 IP 阻断、重定向链校验）</li><li>[ ] 元数据请求设置超时限制</li><li>[ ] 通过出口代理管控外部请求（可选但推荐）</li></ul><h3 id="_6-4-会话安全" tabindex="-1">6.4 会话安全 <a class="header-anchor" href="#_6-4-会话安全" aria-label="Permalink to “6.4 会话安全”">​</a></h3><ul><li>[ ] session_id 使用 CSPRNG 生成（≥ 128 位）</li><li>[ ] session_id 绑定用户身份</li><li>[ ] 每个请求独立校验 Bearer Token</li><li>[ ] 配置会话空闲超时和绝对超时</li></ul><h3 id="_6-5-本地执行安全" tabindex="-1">6.5 本地执行安全 <a class="header-anchor" href="#_6-5-本地执行安全" aria-label="Permalink to “6.5 本地执行安全”">​</a></h3><ul><li>[ ] 敏感操作前展示完整命令并要求用户确认</li><li>[ ] MCP Server 以最小权限运行</li><li>[ ] 使用沙箱或容器隔离本地 MCP Server</li><li>[ ] 记录 MCP Server 来源、版本和完整性哈希</li></ul><h3 id="_6-6-scope-与权限" tabindex="-1">6.6 Scope 与权限 <a class="header-anchor" href="#_6-6-scope-与权限" aria-label="Permalink to “6.6 Scope 与权限”">​</a></h3><ul><li>[ ] 使用细粒度 scope，禁止 <code>*</code> / <code>all</code></li><li>[ ] 初始授权仅包含最小必要 scope</li><li>[ ] MCP Server 独立校验 scope 对应的实际权限</li><li>[ ] 用户可查看并撤销已授予的权限</li></ul><h2 id="_7-总结" tabindex="-1">7. 总结 <a class="header-anchor" href="#_7-总结" aria-label="Permalink to “7. 总结”">​</a></h2><p>MCP 安全的核心原则：</p><ol><li><strong>OAuth 不等于自动安全</strong> — OAuth 提供框架，安全取决于正确的实现</li><li><strong>MCP Proxy 不是信任边界</strong> — Proxy 不改变授权语义，每一跳都需独立鉴权</li><li><strong>令牌必须有明确受众</strong> — 每个令牌只应被其目标受众接受和使用</li><li><strong>同意必须可解释、可审计、可撤销</strong> — 用户应能理解授予了什么权限，系统应能追溯和回收</li><li><strong>本地执行永远假设不安全</strong> — 本地 MCP Server 具有最高风险等级，必须施加最严格的约束</li></ol><h2 id="_8-参考资料" tabindex="-1">8. 参考资料 <a class="header-anchor" href="#_8-参考资料" aria-label="Permalink to “8. 参考资料”">​</a></h2><table tabindex="0"><thead><tr><th>资料</th><th>链接</th></tr></thead><tbody><tr><td>MCP Authorization Specification</td><td><a href="https://spec.modelcontextprotocol.io/specification/2025-03-26/basic/authorization/" target="_blank" rel="noreferrer">spec.modelcontextprotocol.io</a></td></tr><tr><td>OAuth 2.1</td><td><a href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-v2-1-13" target="_blank" rel="noreferrer">draft-ietf-oauth-v2-1-13</a></td></tr><tr><td>RFC 9700 — OAuth 2.0 Security Best Practices</td><td><a href="https://datatracker.ietf.org/doc/html/rfc9700" target="_blank" rel="noreferrer">datatracker.ietf.org</a></td></tr><tr><td>RFC 9728 — Protected Resource Metadata</td><td><a href="https://datatracker.ietf.org/doc/html/rfc9728" target="_blank" rel="noreferrer">datatracker.ietf.org</a></td></tr><tr><td>RFC 8414 — Authorization Server Metadata</td><td><a href="https://datatracker.ietf.org/doc/html/rfc8414" target="_blank" rel="noreferrer">datatracker.ietf.org</a></td></tr><tr><td>RFC 8693 — Token Exchange</td><td><a href="https://datatracker.ietf.org/doc/html/rfc8693" target="_blank" rel="noreferrer">datatracker.ietf.org</a></td></tr><tr><td>RFC 7009 — Token Revocation</td><td><a href="https://datatracker.ietf.org/doc/html/rfc7009" target="_blank" rel="noreferrer">datatracker.ietf.org</a></td></tr><tr><td>OWASP SSRF Prevention Cheat Sheet</td><td><a href="https://cheatsheetseries.owasp.org/cheatsheets/Server_Side_Request_Forgery_Prevention_Cheat_Sheet.html" target="_blank" rel="noreferrer">cheatsheetseries.owasp.org</a></td></tr><tr><td>OWASP Top 10 A10:2021 — SSRF</td><td><a href="https://owasp.org/Top10/2021/A10_2021-Server-Side_Request_Forgery_%28SSRF%29/" target="_blank" rel="noreferrer">owasp.org</a></td></tr></tbody></table></div></div></main><footer class="VPDocFooter" data-v-d89afd13 data-v-4a2af9f5><!--[--><!--]--><div class="edit-info" data-v-4a2af9f5><!----><div class="last-updated" data-v-4a2af9f5><p class="VPLastUpdated" data-v-4a2af9f5 data-v-0a1a09f1>最后更新于: <time datetime="2026-02-16T12:42:59.000Z" data-v-0a1a09f1></time></p></div></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-4a2af9f5><span class="visually-hidden" id="doc-footer-aria-label" data-v-4a2af9f5>Pager</span><div class="pager" data-v-4a2af9f5><a class="VPLink link pager-link prev" href="/ai/mcp/mcp-client.html" data-v-4a2af9f5><!--[--><span class="desc" data-v-4a2af9f5>上一篇</span><span class="title" data-v-4a2af9f5>MCP 客户端开发指南</span><!--]--></a></div><div class="pager" data-v-4a2af9f5><a class="VPLink link pager-link next" href="/ai/agent/agent-overview.html" data-v-4a2af9f5><!--[--><span class="desc" data-v-4a2af9f5>下一篇</span><span class="title" data-v-4a2af9f5>Agent 技术综述</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-d70b1323 data-v-937f3382><div class="container" data-v-937f3382><p class="message" data-v-937f3382>Powered by <a href="https://vitepress.dev/">VitePress</a>. Statics by <a target="_blank" title="51la网站统计" href="https://v6.51.la/land/3ItqjsY11mrrfGg3">51la统计</a></p><p class="copyright" data-v-937f3382>Copyright © 2024 <a href="https://github.com/naico-wang">Naico Wang</a></p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"ai_agent_agent-overview.md\":\"ljd5wbxE\",\"ai_index.md\":\"BQ4i9CCb\",\"ai_mcp_mcp-client.md\":\"C2_3sXsE\",\"ai_mcp_mcp-introduction.md\":\"ayk_k1Ii\",\"ai_mcp_mcp-security.md\":\"B0L4iwfE\",\"ai_mcp_mcp-server.md\":\"OXsBFHtw\",\"ai_vibe-coding_claude-code-guide.md\":\"BeqRxoa0\",\"index.md\":\"D8t8BaNP\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"智库\",\"description\":\"苟利国家生死以，岂因祸福避趋之\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"logo\":{\"light\":\"/images/logo-light.svg\",\"dark\":\"/images/logo-dark.svg\"},\"search\":{\"provider\":\"local\"},\"nav\":[{\"text\":\"首页\",\"link\":\"/\"},{\"text\":\"AI 工程化\",\"link\":\"/ai\"}],\"sidebar\":[{\"text\":\"AI 工程化规范\",\"position\":3,\"items\":[{\"text\":\"模型上下文协议\",\"position\":1,\"items\":[{\"text\":\"MCP 总览\",\"position\":1,\"link\":\"/ai/mcp/mcp-introduction\"},{\"text\":\"MCP 服务端开发指南\",\"position\":2,\"link\":\"/ai/mcp/mcp-server\"},{\"text\":\"MCP 客户端开发指南\",\"position\":3,\"link\":\"/ai/mcp/mcp-client\"},{\"text\":\"MCP 认证与安全\",\"position\":6,\"link\":\"/ai/mcp/mcp-security\"}],\"collapsed\":false},{\"text\":\"人工智能体\",\"position\":2,\"items\":[{\"text\":\"Agent 技术综述\",\"position\":1,\"link\":\"/ai/agent/agent-overview\"}],\"collapsed\":false},{\"text\":\"氛围编程\",\"position\":88,\"items\":[{\"text\":\"Claude Code 使用指南\",\"position\":999,\"link\":\"/ai/vibe-coding/claude-code-guide\"}],\"collapsed\":false}],\"collapsed\":false}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/naico-wang/naico-wang.github.io\"},{\"icon\":\"linkedin\",\"link\":\"https://www.linkedin.com/in/naico-wang-49554891/\"}],\"outline\":{\"label\":\"页面导航\"},\"lastUpdated\":{\"text\":\"最后更新于\",\"formatOptions\":{\"dateStyle\":\"short\",\"timeStyle\":\"short\",\"forceLocale\":true}},\"docFooter\":{\"prev\":\"上一篇\",\"next\":\"下一篇\"},\"footer\":{\"message\":\"Powered by <a href=\\\"https://vitepress.dev/\\\">VitePress</a>. Statics by <a target=\\\"_blank\\\" title=\\\"51la网站统计\\\" href=\\\"https://v6.51.la/land/3ItqjsY11mrrfGg3\\\">51la统计</a>\",\"copyright\":\"Copyright © 2024 <a href=\\\"https://github.com/naico-wang\\\">Naico Wang</a>\"},\"returnToTopLabel\":\"回顶部\",\"sidebarMenuLabel\":\"菜单\",\"externalLinkIcon\":true},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false,\"additionalConfig\":{}}");</script>
    
  </body>
</html>
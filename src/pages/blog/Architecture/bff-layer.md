---
title: BFF的正确打开方式
date: 2024-07-01
abstract: 这篇文章其实阐述了很多观点，关于BFF，关于多端API，关于应该如何选型，请自行理解。文章最后我会附上参考链接。
---

# BFF 模式： Backends For Frontends

> 英文原文地址：[https://samnewman.io/patterns/architectural/bff/](https://samnewman.io/patterns/architectural/bff/)，水平有限，翻译有误敬请谅解。

很多年前以前，就有人提出了BFF的概念。就是**为前端UI展示和外部方提供单一用途的边缘服务**。

## 介绍

众所周知，我们一般公司的架构都是一套后端的WebService（这里统称WebService，即Web服务。），对应着前端的一些展示页面以及承载相应的CRUD的需求。

随着移动应用的越来越普及，这样的后端服务将变成噩梦。所以基于SAAS的解决方案普遍增长。

但是好景不长，我们马上发现移动时代的到来，让我们遇到了一些问题。比如我们有一些服务器端功能，我们希望通过桌面 Web UI 和一个或多个移动 UI 来展示这些功能。对于最初以桌面 Web UI 为开发目标的系统，我们经常面临适应这些新类型用户界面的问题，通常是因为我们已经将桌面 Web UI 与我们的后端服务紧密耦合。

## 以通用为目的的API后端(The General-Purpose API Backend)

适应多种 UI 类型的第一步通常是提供单一的服务器端 API，并随着时间的推移根据需要添加更多功能以支持新类型的移动交互：

![通用API后端](https://samnewman.io/pattern-img/bff/single-api.jpg)
*通用API后端*

如果这些不同的 UI 想要进行相同或非常相似的调用，那么这种通用 API 很容易成功。然而，移动体验的性质通常与桌面 Web 体验截然不同。首先，移动设备的功能非常不同。我们的屏幕空间更小，这意味着我们可以显示的数据更少。打开大量与服务器端资源的连接会耗尽电池寿命并限制数据计划。其次，我们想在移动设备上提供的交互性质可能截然不同。想想一个典型的实体零售商。在桌面应用程序上，我可能允许您查看待售商品、在线订购或在店内预订。但在移动设备上，我可能希望允许您扫描条形码进行价格比较或在店内为您提供基于上下文的优惠。随着我们构建越来越多的移动应用程序，我们逐渐意识到人们使用它们的方式非常不同，因此我们需要公开的功能也会有所不同。

因此，实际上，我们的移动设备会希望进行不同的调用，更少的调用，并希望显示与桌面设备不同的（可能更少）数据。这意味着我们需要在 API 后端添加其他功能来支持我们的移动界面。

通用 API 后端的另一个问题是，它们按定义向多个面向用户的应用程序提供功能。这意味着，在推出新交付时，单个 API 后端可能会成为瓶颈，因为要对同一个可部署工件进行如此多的更改。

通用 API 后端倾向于承担多项职责，因此需要大量工作，这通常会导致专门成立一个团队来处理此代码库。这可能会使问题变得更加严重，因为现在前端团队必须与一个单独的团队进行交互才能进行更改 - 这个团队必须平衡不同客户团队的优先级，还要与多个下游团队合作以使用可用的新 API。可以说，此时我们刚刚在我们的架构中创建了一个智能中间件，它不专注于任何特定的业务领域 - 这与许多人对合理的面向服务架构的看法相悖。

![通用API后端常见架构](https://samnewman.io/pattern-img/bff/general-purpose-api-teams.jpg)
*通用API后端常见架构*

## 为前端引入 BFF 层
我看到 REA 和 SoundCloud 都在使用一种解决此问题的方法，即不采用通用 API 后端，而是为每个用户体验提供一个后端 - 或者如（前 SoundCloud 员工）Phil Calçado所称的“前端的后端”（BFF）。从概念上讲，您应该将面向用户的应用程序视为两个组件 - 一个位于外围的客户端应用程序和一个位于外围的服务器端组件（BFF）。

BFF 与特定的用户体验紧密耦合，通常由与用户界面相同的团队维护，从而更容易根据 UI 的要求定义和调整 API，同时简化了客户端和服务器组件的发布流程。

![分开的BFF层](https://samnewman.io/pattern-img/bff/bff-overview.jpg)
*每个用户界面使用一个服务器端 BFF*

BFF 专注于单个 UI，而且只专注于该 UI。这样可以集中精力，因此体积会更小。

## 我们究竟需要多少个 BFF 层？

谈到在不同平台上提供相同（或类似）的用户体验，我看到了两种不同的方法。我更喜欢的模型是严格为每种不同类型的客户提供一个 BFF - 这是我在 REA 看到的模型：

![不同的BFF](https://samnewman.io/pattern-img/bff/one-bff-per-mobile.jpg)
*不同的移动平台，不同的 BFF，如 REA 所用*

另一种模型是我在 SoundCloud 看到的，它为每种类型的用户界面使用一个 BFF。因此，Android 和 iOS 版本的监听器原生应用程序都使用相同的 BFF：

![不同的BFF2](https://samnewman.io/pattern-img/bff/generic-mobile-bff.jpg)
*为不同的移动后端设置一个 BFF，就像 SoundCloud 那样*

我对第二种模型的主要担忧是，使用单个 BFF 的客户端类型越多，它就越有可能因处理多个问题而变得臃肿。不过，这里要理解的关键是，即使共享 BFF，它也适用于同一类用户界面 - 因此，虽然 SoundCloud 的 iOS 和 Android 监听器原生应用程序使用相同的 BFF，但其他原生应用程序会使用不同的 BFF（例如，新的 Creator 应用程序 Pulse 使用不同的 BFF）。如果同一个团队同时拥有 Android 和 iOS 应用程序以及 BFF，我也更愿意使用此模型 - 如果这些应用程序由不同的团队维护，我更倾向于推荐更严格的模型。因此，您可以看到您的组织结构是决定哪种模型最有意义的主要驱动因素之一（康威定律再次获胜）。值得注意的是，我采访过的 SoundCloud 工程师表示，如果今天再次做出决定，他们可能会重新考虑为 Android 和 iOS 监听器应用程序使用一个 BFF。

我非常喜欢 Stewart Gleadow（他又赞扬了 Phil Calçado 和 Mustafa Sezgin）的一条指导方针，那就是“一种体验，一个 BFF”。因此，如果 iOS 和 Android 的体验非常相似，那么就更容易证明拥有一个 BFF 是合理的。然而，如果它们差异很大，那么拥有单独的 BFF 更有意义。

Pete Hodgson 观察到，BFF 在团队边界内协调一致时效果最佳，因此团队结构应该决定您拥有多少个 BFF。因此，如果您有一个移动团队，您应该有一个 BFF，但如果您有单独的 iOS 和 Android 团队，那么您将拥有单独的 BFF。我担心的是，团队结构往往比我们的系统设计更具流动性。因此，如果您有一个移动 BFF，然后将团队分为 iOS 和 Android 专业，您是否也必须拆分 BFF？如果 BFF 已经分开，那么拆分团队会更容易，因为您可以重新分配已经独立的资产的所有权。不过，BFF 和团队结构的相互作用很重要，我们将很快对此进行进一步探讨。

通常，减少 BFF 数量的目的是为了重用服务器端功能以避免过多的重复，但还有其他方法可以解决这个问题，我们将很快介绍。

## 多个下游服务（微服务！）

对于后端服务数量较少的架构，BFF 可能是一种有用的模式。然而，对于使用大量服务的组织来说，它们可能是必不可少的，因为聚合多个下游调用以提供用户功能的需求急剧增加。在这种情况下，对 BFF 的一次调用通常会导致对微服务的多次下游调用。例如，想象一个电子商务公司的应用程序。我们希望提取用户愿望清单中的商品列表，显示库存水平和价格：

｜----｜----｜----｜----｜
｜刹车 ｜ 献血	有货！（剩余 14 件）｜ 5.99 美元 ｜	现在下单 ｜
蓝色果汁 - Retrospectable	缺货	17.50美元	预购
热芯片——为什么有意义？	速度飞快（剩余 2 件）	9.99 美元	现在下单
